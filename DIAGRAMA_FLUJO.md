# ğŸ”„ DIAGRAMA DE FLUJO - Sistema Colaborativo

## ğŸ“Š ARQUITECTURA DEL SISTEMA

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    USUARIOS (4 cuentas)                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  fconuva    â”‚   alicia    â”‚  joselin    â”‚        pia           â”‚
â”‚  (admin)    â”‚  (teacher)  â”‚  (teacher)  â”‚     (teacher)        â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚             â”‚             â”‚             â”‚
       â”‚             â”‚             â”‚             â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚   FRONTEND (registro-notas.html) â”‚
       â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
       â”‚   â”‚   SessionStorage        â”‚   â”‚
       â”‚   â”‚   â”œâ”€â”€ username          â”‚   â”‚
       â”‚   â”‚   â”œâ”€â”€ userRole          â”‚   â”‚
       â”‚   â”‚   â””â”€â”€ userFullName      â”‚   â”‚
       â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
       â”‚                                  â”‚
       â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
       â”‚   â”‚   LocalStorage (Backup) â”‚   â”‚
       â”‚   â”‚   â””â”€â”€ allCourses[]      â”‚   â”‚
       â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â”‚ Auto-sync cada 30 seg
                  â”‚
                  â–¼
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚   NETLIFY FUNCTIONS              â”‚
       â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
       â”‚   â”‚  GET /api/courses       â”‚   â”‚
       â”‚   â”‚  â”œâ”€ Ignora username     â”‚   â”‚
       â”‚   â”‚  â”œâ”€ Usa 'fconuva'       â”‚   â”‚
       â”‚   â”‚  â””â”€ Retorna todos       â”‚   â”‚
       â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
       â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
       â”‚   â”‚  POST /api/courses/save â”‚   â”‚
       â”‚   â”‚  â”œâ”€ Ignora username     â”‚   â”‚
       â”‚   â”‚  â”œâ”€ Usa 'fconuva'       â”‚   â”‚
       â”‚   â”‚  â””â”€ Guarda en DB        â”‚   â”‚
       â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â”‚ SIEMPRE usa user_id de 'fconuva'
                  â”‚
                  â–¼
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚   NEON DATABASE (PostgreSQL)     â”‚
       â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
       â”‚   â”‚  users table            â”‚   â”‚
       â”‚   â”‚  â”œâ”€ id: 1               â”‚   â”‚
       â”‚   â”‚  â””â”€ username: 'fconuva' â”‚   â”‚
       â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
       â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
       â”‚   â”‚  courses table          â”‚   â”‚
       â”‚   â”‚  (BASE DE DATOS         â”‚   â”‚
       â”‚   â”‚   COMPARTIDA)           â”‚   â”‚
       â”‚   â”‚  â”œâ”€ id                  â”‚   â”‚
       â”‚   â”‚  â”œâ”€ user_id: 1 (todos)  â”‚   â”‚
       â”‚   â”‚  â”œâ”€ course_name         â”‚   â”‚
       â”‚   â”‚  â”œâ”€ subject             â”‚   â”‚
       â”‚   â”‚  â”œâ”€ period              â”‚   â”‚
       â”‚   â”‚  â”œâ”€ config              â”‚   â”‚
       â”‚   â”‚  â”œâ”€ students            â”‚   â”‚
       â”‚   â”‚  â””â”€ tasks               â”‚   â”‚
       â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ FLUJO 1: CREACIÃ“N DE CURSO

```
USUARIO A (fconuva)
    â”‚
    â”‚ 1. Crea nuevo curso "MatemÃ¡ticas 2025"
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   FRONTEND       â”‚
â”‚ createNewCourse()â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ 2. Genera ID Ãºnico (Date.now())
     â”‚ 3. Agrega a allCourses[]
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ saveAllCourses() â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”œâ”€ 4a. Guarda en localStorage (INMEDIATO) âœ…
     â”‚
     â””â”€ 4b. Llama syncCoursesToDatabase()
         â”‚
         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ POST /api/courses/ â”‚
    â”‚      save          â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ 5. Backend recibe { courses: [...] }
         â”‚ 6. Usa 'fconuva' como user_id
         â”‚ 7. INSERT INTO courses...
         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  NEON DATABASE     â”‚
    â”‚  courses           â”‚
    â”‚  user_id = 1       â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ 8. CURSO GUARDADO âœ…
         â–¼

USUARIO B (alicia) - 30 segundos despuÃ©s
    â”‚
    â”‚ Auto-refresh ejecuta
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ GET /api/courses â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ 9. Backend retorna todos los cursos de user_id=1
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   FRONTEND       â”‚
â”‚ allCourses = DB  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ 10. Detecta nuevo curso
     â”‚ 11. Actualiza selector de cursos
     â–¼
USUARIO B VE "MatemÃ¡ticas 2025" âœ…
```

---

## ğŸ”„ FLUJO 2: EDICIÃ“N DE NOTAS

```
USUARIO C (joselin)
    â”‚
    â”‚ 1. Marca checkbox de tarea
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  updateGrade()   â”‚
â”‚  studentIndex: 5 â”‚
â”‚  gradeIndex: 2   â”‚
â”‚  checked: true   â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ 2. courseData.students[5].grades[2] = true
     â”‚ 3. renderTable() â†’ UI actualizada
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ saveAllCourses() â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”œâ”€ 4a. localStorage âœ…
     â”‚
     â””â”€ 4b. syncCoursesToDatabase()
         â”‚
         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ POST /api/courses/ â”‚
    â”‚      save          â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ 5. UPDATE courses SET...
         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  NEON DATABASE     â”‚
    â”‚  (ACTUALIZADO)     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

USUARIO D (pia) - 30 segundos despuÃ©s
    â”‚
    â”‚ Auto-refresh
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ GET /api/courses â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ 6. Recibe cursos actualizados
     â”‚ 7. Compara con courseData actual
     â”‚ 8. Detecta cambios
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  renderTable()   â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
USUARIO D VE CHECKBOX MARCADO âœ…
```

---

## ğŸ”„ FLUJO 3: CAMBIO DE CURSO

```
USUARIO (cualquiera)
    â”‚
    â”‚ 1. Edita Curso A
    â”‚ 2. Selecciona Curso B en dropdown
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ switchCourse()   â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ âš ï¸ CRÃTICO: Guardar primero
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ saveAllCourses() â”‚ â† Guarda Curso A
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ Timeout 100ms
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ loadCourse(B)    â”‚ â† Carga Curso B
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ Mensaje: "âœ… Curso anterior guardado"
     â–¼
CURSO B CARGADO, CURSO A GUARDADO âœ…
```

---

## ğŸ”„ FLUJO 4: AUTO-REFRESH (Cada 30 segundos)

```
     â° Timer: 30 segundos
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ setInterval(30000)   â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ 1. Muestra indicador de sync
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ GET /api/courses     â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ 2. Recibe cursos desde BD
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Comparar con local   â”‚
â”‚ JSON.stringify()     â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”œâ”€ 3a. Â¿HAY CAMBIOS? â†’ SÃ
     â”‚    â”‚
     â”‚    â”œâ”€ Actualiza allCourses
     â”‚    â”œâ”€ Actualiza courseData
     â”‚    â”œâ”€ renderTable()
     â”‚    â””â”€ console.log('âœ¨ Cambios detectados')
     â”‚
     â””â”€ 3b. Â¿HAY CAMBIOS? â†’ NO
          â”‚
          â””â”€ No hace nada
               â”‚
               â–¼
          â° Espera 30 segundos mÃ¡s
```

---

## ğŸ”„ FLUJO 5: SIN CONEXIÃ“N A INTERNET

```
USUARIO intenta editar
    â”‚
    â”‚ 1. Marca checkbox
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ updateGrade()    â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ 2. Actualiza courseData
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ saveAllCourses() â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”œâ”€ 3a. localStorage âœ… (FUNCIONA)
     â”‚
     â””â”€ 3b. syncCoursesToDatabase()
         â”‚
         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ fetch(...) FAIL    â”‚
    â”‚ âŒ Network Error    â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ 4. catch(error)
         â”‚    console.warn('âš ï¸ Sin conexiÃ³n')
         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ NO BLOQUEA UI      â”‚
    â”‚ Datos en localStorage â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

USUARIO sigue trabajando âœ…

Cuando vuelve conexiÃ³n:
    â”‚
    â”‚ Auto-refresh ejecuta
    â”‚ O prÃ³ximo saveAllCourses()
    â–¼
syncCoursesToDatabase() âœ…
    â”‚
    â””â”€ Sincroniza datos pendientes
```

---

## ğŸ”„ FLUJO 6: USUARIO NUEVO (Primera vez)

```
NUEVA PROFESORA "pia"
    â”‚
    â”‚ 1. Inicia sesiÃ³n por primera vez
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Login exitoso    â”‚
â”‚ sessionStorage   â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ 2. Carga dashboard
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ loadAllCourses() â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ 3. localStorage vacÃ­o
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚loadCoursesFromDatabase()â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ 4. GET /api/courses?username=pia
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ BACKEND          â”‚
â”‚ Usa 'fconuva'    â”‚
â”‚ Ignora 'pia'     â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ 5. Verifica si existe user 'fconuva'
     â”‚    â”œâ”€ Existe â†’ Retorna sus cursos
     â”‚    â””â”€ No existe â†’ Crea usuario + retorna vacÃ­o
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FRONTEND         â”‚
â”‚ Recibe cursos    â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ 6. allCourses = cursos de fconuva
     â”‚ 7. Guarda en localStorage
     â–¼
PIA VE TODOS LOS CURSOS âœ…
```

---

## ğŸ“Š COMPONENTES CLAVE

### ğŸ”¹ FRONTEND

```javascript
// Funciones Principales
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ loadAllCourses()            â”‚ â† Punto de entrada
â”‚  â”œâ”€ loadCoursesFromDatabase()â”‚ â† Carga desde BD
â”‚  â””â”€ MigraciÃ³n automÃ¡tica     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ saveAllCourses()            â”‚ â† Guardado dual
â”‚  â”œâ”€ localStorage (inmediato)â”‚
â”‚  â””â”€ syncCoursesToDatabase() â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Auto-refresh (30 seg)       â”‚ â† SincronizaciÃ³n
â”‚  â”œâ”€ GET /api/courses        â”‚
â”‚  â”œâ”€ Compara cambios         â”‚
â”‚  â””â”€ Actualiza si necesario  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ”¹ BACKEND

```javascript
// Netlify Functions
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ get-courses.js              â”‚
â”‚  const sharedUsername =     â”‚
â”‚        'fconuva'            â”‚ â† CLAVE
â”‚  SELECT * FROM courses      â”‚
â”‚  WHERE user_id = 1          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ save-courses.js             â”‚
â”‚  const sharedUsername =     â”‚
â”‚        'fconuva'            â”‚ â† CLAVE
â”‚  INSERT/UPDATE courses      â”‚
â”‚  WHERE user_id = 1          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ PUNTOS CRÃTICOS DE Ã‰XITO

### âœ… 1. Username Fijo en Backend
```javascript
const sharedUsername = 'fconuva';
// â†‘ Este cambio hace que todos compartan la misma base
```

### âœ… 2. Auto-Guardado en switchCourse()
```javascript
function switchCourse() {
    saveAllCourses(); // â† Guarda ANTES de cambiar
    setTimeout(() => loadCourse(newId), 100);
}
```

### âœ… 3. Auto-Refresh Cada 30 Segundos
```javascript
setInterval(async () => {
    // Carga cursos desde BD
    // Detecta cambios
    // Actualiza vista
}, 30000);
```

### âœ… 4. SincronizaciÃ³n Dual
```javascript
function saveAllCourses() {
    localStorage.setItem(...);        // Inmediato
    syncCoursesToDatabase().catch(); // Background
}
```

---

## ğŸ”’ SEGURIDAD Y PERMISOS

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ACCIONES POR ROL                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ADMIN (fconuva)                  â”‚
â”‚   âœ… Ver cursos                    â”‚
â”‚   âœ… Crear cursos                  â”‚
â”‚   âœ… Editar cursos                 â”‚
â”‚   âœ… Eliminar cursos               â”‚
â”‚   âœ… Borrar todos los datos        â”‚
â”‚   âœ… Resetear sistema              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  TEACHER (alicia/joselin/pia)     â”‚
â”‚   âœ… Ver cursos                    â”‚
â”‚   âœ… Crear cursos                  â”‚
â”‚   âœ… Editar cursos                 â”‚
â”‚   âŒ Eliminar cursos               â”‚
â”‚   âŒ Borrar todos los datos        â”‚
â”‚   âŒ Resetear sistema              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âš¡ OPTIMIZACIONES

### ğŸ“ˆ Performance
- LocalStorage para acceso instantÃ¡neo
- Base de datos para persistencia
- Auto-refresh no bloquea UI
- SincronizaciÃ³n en background

### ğŸ›¡ï¸ Confiabilidad
- Dual-save (localStorage + BD)
- Fallback automÃ¡tico
- Manejo de errores silencioso
- RecuperaciÃ³n automÃ¡tica de conexiÃ³n

### ğŸ‘¥ ColaboraciÃ³n
- Todos ven los mismos datos
- SincronizaciÃ³n automÃ¡tica cada 30 seg
- DetecciÃ³n inteligente de cambios
- Sin conflictos de versiones

---

*Diagrama actualizado: 15 de Octubre, 2025*
