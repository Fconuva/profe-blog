---
layout: layout.njk
title: "Gu√≠a de Estudio: Lenguaje y Comunicaci√≥n"
description: "Dominios, objetivos y ejemplos para preparar la evaluaci√≥n de Lenguaje y Comunicaci√≥n."
---

<div class="min-h-screen bg-gray-50">
  <div class="container mx-auto px-4 py-10">

    <div class="max-w-5xl mx-auto">
      <div class="text-center mb-10">
        <h1 class="text-4xl md:text-5xl font-bold text-gray-800">Gu√≠a de Estudio</h1>
        <p class="text-gray-600 text-lg mt-2">Lenguaje y Comunicaci√≥n ‚Äî basado en el temario y el plan de estudio</p>
        <div class="mt-4">
          <a href="/evaluaciones/educacion-basica/estudio/" class="text-indigo-700 hover:text-indigo-900 font-medium">‚Üê Todas las gu√≠as</a>
          <button type="button" id="btn-print" class="ml-4 inline-flex items-center bg-gray-800 hover:bg-gray-700 text-white font-medium py-2 px-3 rounded-md">
            Imprimir / Exportar PDF
          </button>
        </div>
      </div>

      {% if plan.study and plan.study.length %}
      <div class="space-y-10">
        {% for bloque in plan.study %}
        <section class="bg-white rounded-2xl shadow p-6 md:p-8">
          <h2 class="text-2xl md:text-3xl font-bold text-gray-800 mb-2">{{ bloque.domain }}</h2>
          {% if bloque.subsections and bloque.subsections.length %}
            <div class="mt-4 space-y-8">
              {% for sub in bloque.subsections %}
              <div id="{{ sub.titulo | slug }}">
                <h3 class="text-xl font-semibold text-gray-800 mb-3">{{ sub.titulo }}</h3>
                {# Mini ToC espec√≠fico para Textos literarios #}
                {% if sub.titulo | lower == 'textos literarios' %}
                  <div class="flex flex-wrap gap-2 mb-3 text-sm">
                    <a href="#lit-narrativa" class="px-2 py-1 rounded bg-indigo-50 text-indigo-700 border border-indigo-100">Narrativa</a>
                    <a href="#lit-poesia" class="px-2 py-1 rounded bg-indigo-50 text-indigo-700 border border-indigo-100">Poes√≠a</a>
                    <a href="#lit-drama" class="px-2 py-1 rounded bg-indigo-50 text-indigo-700 border border-indigo-100">Drama</a>
                    <a href="#casos-{{ sub.titulo | slug }}" class="px-2 py-1 rounded bg-gray-50 text-gray-700 border">Casos de estudio ‚Üì</a>
                  </div>
                {% endif %}
                {% if sub.objetivos and sub.objetivos.length %}
                <div class="space-y-6">
                  {% set litNarr = false %}
                  {% set litPoes = false %}
                  {% set litDrama = false %}
                  {% for obj in sub.objetivos %}
                    {% set txt = (obj.enunciado or '') | lower %}
                    {% if sub.titulo | lower == 'textos literarios' %}
                      {% if not litNarr and ( 'narrativ' in txt or 'narrador' in txt or 'mundo narrado' in txt or 'g√©neros narrativos' in txt ) %}
                        <h4 id="lit-narrativa" class="text-lg font-bold text-gray-900 mt-8 mb-4 flex items-center gap-2">
                          <span class="text-2xl">üìñ</span> Narrativa
                        </h4>
                        {% set litNarr = true %}
                      {% endif %}
                      {% if not litPoes and ( 'po√©tic' in txt or 'poema' in txt or 'figuras literarias' in txt or 'm√©trica' in txt or 'rima' in txt ) %}
                        <h4 id="lit-poesia" class="text-lg font-bold text-gray-900 mt-8 mb-4 flex items-center gap-2">
                          <span class="text-2xl">‚ú®</span> Poes√≠a
                        </h4>
                        {% set litPoes = true %}
                      {% endif %}
                      {% if not litDrama and ( 'dram√°t' in txt or 'tragedia' in txt or 'comedia' in txt or 'farsa' in txt or 'g√©nero dram√°tico' in txt or 'soliloquio' in txt or 'mon√≥logo' in txt ) %}
                        <h4 id="lit-drama" class="text-lg font-bold text-gray-900 mt-8 mb-4 flex items-center gap-2">
                          <span class="text-2xl">üé≠</span> Drama
                        </h4>
                        {% set litDrama = true %}
                      {% endif %}
                    {% endif %}
                    <div class="bg-white border-2 border-indigo-100 rounded-xl p-5 shadow-sm hover:shadow-md transition-shadow duration-200">
                      <div class="flex items-start gap-3">
                        <span class="text-2xl flex-shrink-0">üéØ</span>
                        <div class="flex-1">
                          <p class="font-semibold text-gray-900 text-base leading-relaxed">{{ obj.enunciado }}</p>
                          {% if obj.explicacion %}
                            <p class="text-gray-600 mt-2 text-sm leading-relaxed">{{ obj.explicacion }}</p>
                          {% endif %}
                          <div class="mt-4 flex gap-2 flex-wrap">
                            <button type="button" class="ia-explain-obj bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 text-white text-sm font-semibold py-2.5 px-4 rounded-lg shadow-sm transition-all duration-200 flex items-center gap-2" data-objetivo="{{ obj.enunciado | escape }}" data-tema="{{ sub.titulo | escape }}">
                              <span>ü§ñ</span> IA: Explicar con ejemplos
                            </button>
                          </div>
                          <div class="mt-3 hidden" id="ia-obj-box-{{ loop.index }}"></div>
                          {% if obj.ejemplo %}
                          <details class="mt-4 group">
                            <summary class="cursor-pointer select-none text-indigo-600 hover:text-indigo-700 font-medium text-sm flex items-center gap-2">
                              <span class="transition-transform group-open:rotate-90">‚ñ∂</span> Ver ejemplo pr√°ctico
                            </summary>
                            <div class="mt-3 bg-gradient-to-br from-indigo-50 to-purple-50 border-2 border-indigo-200 rounded-lg p-4">
                              {% if obj.ejemplo.contexto %}
                                <div class="mb-3">
                                  <span class="inline-block text-xs font-bold text-indigo-700 uppercase tracking-wide mb-1">üìù Contexto</span>
                                  <p class="text-sm text-gray-800 leading-relaxed">{{ obj.ejemplo.contexto }}</p>
                                </div>
                              {% endif %}
                              {% if obj.ejemplo.pregunta %}
                                <div class="mb-3">
                                  <span class="inline-block text-xs font-bold text-purple-700 uppercase tracking-wide mb-1">‚ùì Ejercicio</span>
                                  <p class="text-sm text-gray-800 leading-relaxed">{{ obj.ejemplo.pregunta }}</p>
                                </div>
                              {% endif %}
                              {% if obj.ejemplo.respuesta_modelo %}
                                <div class="bg-white rounded-md p-3 border border-indigo-200">
                                  <span class="inline-block text-xs font-bold text-emerald-700 uppercase tracking-wide mb-1">‚úì Respuesta modelo</span>
                                  <p class="text-sm text-gray-800 leading-relaxed">{{ obj.ejemplo.respuesta_modelo }}</p>
                                </div>
                              {% endif %}
                            </div>
                          </details>
                          {% endif %}
                        </div>
                      </div>
                    </div>
                  {% endfor %}
                </div>
                {% endif %}

                {# Casos de estudio vinculados a este subtema #}
                {% set subkey = sub.titulo | lower %}
                {% set casos = (casosPorSubtema and casosPorSubtema[subkey]) or (casosPorTema and casosPorTema[subkey]) or (casosPreset and casosPreset[subkey]) or [] %}
                <div id="casos-{{ sub.titulo | slug }}" class="mt-10">
                  <div class="flex items-center gap-3 mb-6">
                    <span class="text-3xl">üß™</span>
                    <h4 class="text-xl font-bold text-gray-900">Casos de estudio</h4>
                    <span class="ml-auto text-sm text-gray-500 bg-gray-100 px-3 py-1 rounded-full">{{ casos | length }} casos</span>
                  </div>
                  {% if casos | length > 0 %}
                    <div class="grid md:grid-cols-2 gap-5">
                      {% for c in casos | slice(0,6) %}
                        <div class="bg-white border-2 border-gray-200 rounded-xl p-5 shadow-sm hover:shadow-lg hover:border-indigo-300 transition-all duration-300">
                          <div class="flex items-start gap-3 mb-3">
                            <span class="text-xl flex-shrink-0">üí°</span>
                            <p class="font-semibold text-gray-900 text-sm leading-relaxed">{{ c.enunciado }}</p>
                          </div>
                          <div class="space-y-2 mb-3">
                            {% for alt in c.alternativas %}
                              <div class="flex items-start gap-2 text-sm text-gray-700 bg-gray-50 p-2 rounded-md">
                                <span class="font-bold text-indigo-600 flex-shrink-0">{{ alt.opcion }})</span>
                                <span>{{ alt.texto }}</span>
                              </div>
                            {% endfor %}
                          </div>
                          {% if c.temas_relacionados and c.temas_relacionados.length %}
                          <div class="mt-3 flex flex-wrap gap-1.5">
                            {% for t in c.temas_relacionados %}
                              <span class="inline-block text-xs bg-indigo-100 text-indigo-700 px-2.5 py-1 rounded-full font-medium">{{ t }}</span>
                            {% endfor %}
                          </div>
                          {% endif %}
                          <details class="mt-4 group">
                            <summary class="text-indigo-600 hover:text-indigo-700 cursor-pointer font-semibold text-sm flex items-center gap-2">
                              <span class="transition-transform group-open:rotate-90">‚ñ∂</span> Ver soluci√≥n y explicaci√≥n
                            </summary>
                            <div class="mt-3 bg-gradient-to-br from-emerald-50 to-teal-50 border-2 border-emerald-200 rounded-lg p-4">
                              <div class="bg-white rounded-md p-3 border-l-4 border-emerald-500 mb-3">
                                <p class="text-sm font-bold text-emerald-700 mb-1">‚úì Respuesta correcta: {{ c.respuesta_correcta }}</p>
                                {% set correcta = '' %}
                                {% for alt in c.alternativas %}
                                  {% if alt.opcion == c.respuesta_correcta %}
                                    {% set correcta = alt.texto %}
                                  {% endif %}
                                {% endfor %}
                                <p class="text-sm text-gray-700">{{ correcta }}</p>
                              </div>
                              <p class="text-sm text-gray-700 leading-relaxed mb-4">{{ c.explicacion }}</p>
                              <button type="button" class="ia-explain-caso bg-gradient-to-r from-blue-500 to-indigo-600 hover:from-blue-600 hover:to-indigo-700 text-white text-xs font-semibold py-2 px-4 rounded-lg shadow-sm transition-all duration-200 flex items-center gap-2" data-pregunta="{{ c.enunciado | escape }}" data-respuesta="{{ c.respuesta_correcta }}: {{ correcta | escape }}" data-tema="{{ sub.titulo | escape }}">
                                <span>ü§ñ</span> IA: Justificar respuesta
                              </button>
                              <div class="mt-3 hidden ia-caso-box"></div>
                            </div>
                          </details>
                        </div>
                      {% endfor %}
                    </div>
                    {% if casos.length > 6 %}
                    <details class="mt-6 group">
                      <summary class="bg-gradient-to-r from-indigo-500 to-purple-600 hover:from-indigo-600 hover:to-purple-700 text-white font-bold py-3 px-6 rounded-lg cursor-pointer text-center flex items-center justify-center gap-2 shadow-md transition-all duration-200">
                        <span class="transition-transform group-open:rotate-180">‚ñº</span>
                        Ver m√°s casos ({{ casos.length - 6 }} adicionales)
                      </summary>
                      <div class="mt-5 grid md:grid-cols-2 gap-5">
                        {% for c in casos | slice(6) %}
                          <div class="bg-white border-2 border-gray-200 rounded-xl p-5 shadow-sm hover:shadow-lg hover:border-indigo-300 transition-all duration-300">
                            <div class="flex items-start gap-3 mb-3">
                              <span class="text-xl flex-shrink-0">üí°</span>
                              <p class="font-semibold text-gray-900 text-sm leading-relaxed">{{ c.enunciado }}</p>
                            </div>
                            <div class="space-y-2 mb-3">
                              {% for alt in c.alternativas %}
                                <div class="flex items-start gap-2 text-sm text-gray-700 bg-gray-50 p-2 rounded-md">
                                  <span class="font-bold text-indigo-600 flex-shrink-0">{{ alt.opcion }})</span>
                                  <span>{{ alt.texto }}</span>
                                </div>
                              {% endfor %}
                            </div>
                            <details class="mt-4 group">
                              <summary class="text-indigo-600 hover:text-indigo-700 cursor-pointer font-semibold text-sm flex items-center gap-2">
                                <span class="transition-transform group-open:rotate-90">‚ñ∂</span> Ver soluci√≥n
                              </summary>
                              <div class="mt-3 bg-gradient-to-br from-emerald-50 to-teal-50 border-2 border-emerald-200 rounded-lg p-4">
                                <div class="bg-white rounded-md p-3 border-l-4 border-emerald-500 mb-3">
                                  <p class="text-sm font-bold text-emerald-700">‚úì Respuesta correcta: {{ c.respuesta_correcta }}</p>
                                </div>
                                <p class="text-sm text-gray-700 leading-relaxed">{{ c.explicacion }}</p>
                              </div>
                            </details>
                          </div>
                        {% endfor %}
                      </div>
                    </details>
                    {% endif %}
                  {% else %}
                    <div class="bg-gradient-to-r from-gray-50 to-gray-100 border-2 border-dashed border-gray-300 rounded-xl p-8 text-center">
                      <span class="text-5xl mb-3 block">üì≠</span>
                      <p class="text-gray-600 font-medium">A√∫n no hay casos vinculados a este subtema.</p>
                      <p class="text-sm text-gray-500 mt-1">Los casos se ir√°n agregando progresivamente.</p>
                    </div>
                  {% endif %}
                </div>
              </div>
              {% endfor %}
            </div>
          {% endif %}
        </section>
        {% endfor %}
      </div>
      {% else %}
        <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 rounded">
          No se encontr√≥ contenido de estudio en el plan.
        </div>
      {% endif %}

      <div class="mt-10">
        <a href="/evaluaciones/educacion-basica/pruebas/63-sc-l/practica/" class="inline-flex items-center bg-purple-600 hover:bg-purple-700 text-white font-semibold py-3 px-6 rounded-lg shadow">
          Practicar esta asignatura ‚Üí
        </a>
      </div>
    </div>

  </div>
</div>

<script>
  // IA: Explicar objetivo
  document.addEventListener('click', async (ev) => {
    const btnObj = ev.target.closest('.ia-explain-obj');
    if (btnObj) {
      const objetivo = btnObj.getAttribute('data-objetivo') || '';
      const tema = btnObj.getAttribute('data-tema') || '';
      const box = btnObj.parentElement.nextElementSibling; // ia-obj-box-*
      if (!box) return;
      box.classList.remove('hidden');
      box.innerHTML = `<div class="bg-blue-50 border-l-4 border-blue-400 text-blue-800 p-3 rounded">Generando explicaci√≥n con IA...</div>`;
      try {
        const resp = await fetch('/api/gemini-feedback', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ pregunta: `Explica el objetivo: ${objetivo}`, respuestaDocente: 'Explica con ejemplos, errores comunes y estrategias did√°cticas.', tema })
        });
        const data = await resp.json();
        if (!resp.ok) throw new Error(data.error || 'Error');
        box.innerHTML = `<div class="bg-white border p-3 rounded shadow-sm"><div class="prose prose-sm max-w-none">${(data.feedback || '').replace(/\n/g, '<br>')}</div></div>`;
      } catch (e) {
        box.innerHTML = `<div class="bg-red-50 border-l-4 border-red-400 text-red-800 p-3 rounded">No se pudo generar la explicaci√≥n. ${e.message || ''}</div>`;
      }
    }

    const btnCaso = ev.target.closest('.ia-explain-caso');
    if (btnCaso) {
      const pregunta = btnCaso.getAttribute('data-pregunta') || '';
      const respuestaDocente = btnCaso.getAttribute('data-respuesta') || '';
      const tema = btnCaso.getAttribute('data-tema') || '';
      const box = btnCaso.parentElement.nextElementSibling; // .ia-caso-box
      if (!box) return;
      box.classList.remove('hidden');
      box.innerHTML = `<div class="bg-blue-50 border-l-4 border-blue-400 text-blue-800 p-3 rounded">Justificando con IA...</div>`;
      try {
        const resp = await fetch('/api/gemini-feedback', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ pregunta, respuestaDocente, tema })
        });
        const data = await resp.json();
        if (!resp.ok) throw new Error(data.error || 'Error');
        box.innerHTML = `<div class="bg-white border p-3 rounded shadow-sm"><div class="prose prose-sm max-w-none">${(data.feedback || '').replace(/\n/g, '<br>')}</div></div>`;
      } catch (e) {
        box.innerHTML = `<div class="bg-red-50 border-l-4 border-red-400 text-red-800 p-3 rounded">No se pudo justificar con IA. ${e.message || ''}</div>`;
      }
    }
  });
</script>
<style>
  /* Estilos de impresi√≥n b√°sicos para exportar PDF desde el navegador */
  @media print {
    header, footer, nav, #mobile-menu, .btn-premium { display: none !important; }
    main { padding: 0 !important; }
    a[href]:after { content: "" !important; }
    .shadow, .shadow-sm, .shadow-md, .shadow-lg { box-shadow: none !important; }
    .border { border-color: #ddd !important; }
    .container, .mx-auto, .max-w-5xl { width: 100% !important; max-width: 100% !important; }
    .rounded, .rounded-lg, .rounded-2xl { border-radius: 0 !important; }
    .bg-gray-50, .bg-white { background: #fff !important; }
  }
</style>
<script>
  // Salud del endpoint IA: deshabilitar botones si no hay API Key
  document.addEventListener('DOMContentLoaded', async () => {
    try {
      const resp = await fetch('/api/gemini-feedback?health=1');
      const data = await resp.json();
      const hasAnyKey = Boolean(data?.hasGemini || data?.hasOpenAI);
      const buttons = document.querySelectorAll('.ia-explain-obj, .ia-explain-caso');
      if (!hasAnyKey) {
        buttons.forEach(btn => {
          btn.disabled = true;
          btn.classList.add('opacity-60', 'cursor-not-allowed');
          btn.title = 'IA deshabilitada temporalmente (falta configuraci√≥n del servidor)';
        });
      } else {
        buttons.forEach(btn => {
          btn.disabled = false;
          btn.classList.remove('opacity-60', 'cursor-not-allowed');
          btn.removeAttribute('title');
        });
      }
    } catch {}
  });

  // Imprimir / Exportar PDF
  document.getElementById('btn-print')?.addEventListener('click', () => window.print());
</script>
