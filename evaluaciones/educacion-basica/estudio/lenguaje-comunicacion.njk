---
layout: layout.njk
title: "Gu√≠a de Estudio: Lenguaje y Comunicaci√≥n"
description: "Dominios, objetivos y ejemplos para preparar la evaluaci√≥n de Lenguaje y Comunicaci√≥n."
---

<div class="min-h-screen bg-gray-50">
  <div class="container mx-auto px-4 py-10">

    <div class="max-w-5xl mx-auto">
      <div class="text-center mb-10">
        <h1 class="text-4xl md:text-5xl font-bold text-gray-800">Gu√≠a de Estudio</h1>
        <p class="text-gray-600 text-lg mt-2">Lenguaje y Comunicaci√≥n ‚Äî basado en el temario y el plan de estudio</p>
        <div class="mt-4">
          <a href="/evaluaciones/educacion-basica/estudio/" class="text-indigo-700 hover:text-indigo-900 font-medium">‚Üê Todas las gu√≠as</a>
          <button type="button" id="btn-print" class="ml-4 inline-flex items-center bg-gray-800 hover:bg-gray-700 text-white font-medium py-2 px-3 rounded-md">
            Imprimir / Exportar PDF
          </button>
        </div>
      </div>

      {% if plan.study and plan.study.length %}
      <div class="space-y-10">
        {% for bloque in plan.study %}
        <section class="bg-white rounded-2xl shadow p-6 md:p-8">
          <h2 class="text-2xl md:text-3xl font-bold text-gray-800 mb-2">{{ bloque.domain }}</h2>
          {% if bloque.subsections and bloque.subsections.length %}
            <div class="mt-4 space-y-8">
              {% for sub in bloque.subsections %}
              <div id="{{ sub.titulo | slug }}">
                <h3 class="text-xl font-semibold text-gray-800 mb-3">{{ sub.titulo }}</h3>
                {# Mini ToC espec√≠fico para Textos literarios #}
                {% if sub.titulo | lower == 'textos literarios' %}
                  <div class="flex flex-wrap gap-2 mb-3 text-sm">
                    <a href="#lit-narrativa" class="px-2 py-1 rounded bg-indigo-50 text-indigo-700 border border-indigo-100">Narrativa</a>
                    <a href="#lit-poesia" class="px-2 py-1 rounded bg-indigo-50 text-indigo-700 border border-indigo-100">Poes√≠a</a>
                    <a href="#lit-drama" class="px-2 py-1 rounded bg-indigo-50 text-indigo-700 border border-indigo-100">Drama</a>
                    <a href="#casos-{{ sub.titulo | slug }}" class="px-2 py-1 rounded bg-gray-50 text-gray-700 border">Casos de estudio ‚Üì</a>
                  </div>
                {% endif %}
                {% if sub.objetivos and sub.objetivos.length %}
                <div class="space-y-6">
                  {% set litNarr = false %}
                  {% set litPoes = false %}
                  {% set litDrama = false %}
                  {% for obj in sub.objetivos %}
                    {% set txt = (obj.enunciado or '') | lower %}
                    {% if sub.titulo | lower == 'textos literarios' %}
                      {% if not litNarr and ( 'narrativ' in txt or 'narrador' in txt or 'mundo narrado' in txt or 'g√©neros narrativos' in txt ) %}
                        <h4 id="lit-narrativa" class="text-base font-semibold text-gray-700 mt-2">Narrativa</h4>
                        {% set litNarr = true %}
                      {% endif %}
                      {% if not litPoes and ( 'po√©tic' in txt or 'poema' in txt or 'figuras literarias' in txt or 'm√©trica' in txt or 'rima' in txt ) %}
                        <h4 id="lit-poesia" class="text-base font-semibold text-gray-700 mt-2">Poes√≠a</h4>
                        {% set litPoes = true %}
                      {% endif %}
                      {% if not litDrama and ( 'dram√°t' in txt or 'tragedia' in txt or 'comedia' in txt or 'farsa' in txt or 'g√©nero dram√°tico' in txt or 'soliloquio' in txt or 'mon√≥logo' in txt ) %}
                        <h4 id="lit-drama" class="text-base font-semibold text-gray-700 mt-2">Drama</h4>
                        {% set litDrama = true %}
                      {% endif %}
                    {% endif %}
                    <div class="border rounded-lg p-4">
                      <p class="font-semibold text-gray-800">üéØ Objetivo: <span class="font-normal">{{ obj.enunciado }}</span></p>
                      {% if obj.explicacion %}
                        <p class="text-gray-700 mt-2">{{ obj.explicacion }}</p>
                      {% endif %}
                      <div class="mt-3 flex gap-2 flex-wrap">
                        <button type="button" class="ia-explain-obj bg-green-600 hover:bg-green-700 text-white text-sm font-semibold py-2 px-3 rounded-md" data-objetivo="{{ obj.enunciado | escape }}" data-tema="{{ sub.titulo | escape }}">
                          ü§ñ IA: Explicar con ejemplos
                        </button>
                        <a href="#casos-{{ sub.titulo | slug }}" class="text-indigo-700 hover:text-indigo-900 text-sm font-medium">
                          Ver casos de estudio ‚Üì
                        </a>
                      </div>
                      <div class="mt-3 hidden" id="ia-obj-box-{{ loop.index }}"></div>
                      {% if obj.ejemplo %}
                      <details class="mt-3 group">
                        <summary class="cursor-pointer select-none text-indigo-700 font-medium">Ver ejemplo</summary>
                        <div class="mt-2 bg-indigo-50 border border-indigo-100 rounded p-3">
                          {% if obj.ejemplo.contexto %}
                            <p class="text-sm text-gray-800"><strong>Contexto:</strong> {{ obj.ejemplo.contexto }}</p>
                          {% endif %}
                          {% if obj.ejemplo.pregunta %}
                            <p class="text-sm text-gray-800 mt-1"><strong>Ejercicio:</strong> {{ obj.ejemplo.pregunta }}</p>
                          {% endif %}
                          {% if obj.ejemplo.respuesta_modelo %}
                            <p class="text-sm text-gray-800 mt-1"><strong>Respuesta modelo:</strong> {{ obj.ejemplo.respuesta_modelo }}</p>
                          {% endif %}
                        </div>
                      </details>
                      {% endif %}
                    </div>
                  {% endfor %}
                </div>
                {% endif %}

                {# Casos de estudio vinculados a este subtema #}
                {% set subkey = sub.titulo | lower %}
                {% set casos = (casosPorSubtema and casosPorSubtema[subkey]) or (casosPorTema and casosPorTema[subkey]) or [] %}
                <div id="casos-{{ sub.titulo | slug }}" class="mt-6">
                  <h4 class="text-lg font-semibold text-gray-800 mb-2">üß™ Casos de estudio</h4>
                  {% if casos and casos.length %}
                    <div class="grid md:grid-cols-2 gap-4">
                      {% for c in casos | slice(0,6) %}
                        <div class="border rounded-lg p-4 bg-gray-50">
                          <p class="font-medium text-gray-800">{{ c.enunciado }}</p>
                          <ul class="mt-2 text-sm text-gray-700 list-disc list-inside">
                            {% for alt in c.alternativas %}
                              <li>{{ alt.opcion }}) {{ alt.texto }}</li>
                            {% endfor %}
                          </ul>
                          {% if c.temas_relacionados and c.temas_relacionados.length %}
                          <div class="mt-2 flex flex-wrap gap-2">
                            {% for t in c.temas_relacionados %}
                              <span class="inline-block text-xs bg-indigo-100 text-indigo-700 px-2 py-0.5 rounded">{{ t }}</span>
                            {% endfor %}
                          </div>
                          {% endif %}
                          <details class="mt-2">
                            <summary class="text-indigo-700 cursor-pointer">Ver soluci√≥n</summary>
                            <div class="mt-2 bg-white border rounded p-3">
                              <p><strong>Respuesta correcta:</strong> {{ c.respuesta_correcta }}</p>
                              <p class="mt-1">{{ c.explicacion }}</p>
                              {% set correcta = '' %}
                              {% for alt in c.alternativas %}
                                {% if alt.opcion == c.respuesta_correcta %}
                                  {% set correcta = alt.texto %}
                                {% endif %}
                              {% endfor %}
                              <div class="mt-3">
                                <button type="button" class="ia-explain-caso bg-blue-600 hover:bg-blue-700 text-white text-xs font-semibold py-2 px-3 rounded" data-pregunta="{{ c.enunciado | escape }}" data-respuesta="{{ c.respuesta_correcta }}: {{ correcta | escape }}" data-tema="{{ sub.titulo | escape }}">
                                  ü§ñ IA: Justificar respuesta
                                </button>
                              </div>
                              <div class="mt-2 hidden ia-caso-box"></div>
                            </div>
                          </details>
                        </div>
                      {% endfor %}
                    </div>
                    {% if casos.length > 6 %}
                    <details class="mt-3">
                      <summary class="text-indigo-700 cursor-pointer">Ver m√°s casos ({{ casos.length - 6 }})</summary>
                      <div class="mt-3 grid md:grid-cols-2 gap-4">
                        {% for c in casos | slice(6) %}
                          <div class="border rounded-lg p-4 bg-gray-50">
                            <p class="font-medium text-gray-800">{{ c.enunciado }}</p>
                            <ul class="mt-2 text-sm text-gray-700 list-disc list-inside">
                              {% for alt in c.alternativas %}
                                <li>{{ alt.opcion }}) {{ alt.texto }}</li>
                              {% endfor %}
                            </ul>
                            <details class="mt-2">
                              <summary class="text-indigo-700 cursor-pointer">Ver soluci√≥n</summary>
                              <div class="mt-2 bg-white border rounded p-3">
                                <p><strong>Respuesta correcta:</strong> {{ c.respuesta_correcta }}</p>
                                <p class="mt-1">{{ c.explicacion }}</p>
                              </div>
                            </details>
                          </div>
                        {% endfor %}
                      </div>
                    </details>
                    {% endif %}
                  {% else %}
                    <p class="text-sm text-gray-600">A√∫n no hay casos vinculados a este subtema.</p>
                  {% endif %}
                </div>
              </div>
              {% endfor %}
            </div>
          {% endif %}
        </section>
        {% endfor %}
      </div>
      {% else %}
        <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 rounded">
          No se encontr√≥ contenido de estudio en el plan.
        </div>
      {% endif %}

      <div class="mt-10">
        <a href="/evaluaciones/educacion-basica/pruebas/63-sc-l/practica/" class="inline-flex items-center bg-purple-600 hover:bg-purple-700 text-white font-semibold py-3 px-6 rounded-lg shadow">
          Practicar esta asignatura ‚Üí
        </a>
      </div>
    </div>

  </div>
</div>

<script>
  // IA: Explicar objetivo
  document.addEventListener('click', async (ev) => {
    const btnObj = ev.target.closest('.ia-explain-obj');
    if (btnObj) {
      const objetivo = btnObj.getAttribute('data-objetivo') || '';
      const tema = btnObj.getAttribute('data-tema') || '';
      const box = btnObj.parentElement.nextElementSibling; // ia-obj-box-*
      if (!box) return;
      box.classList.remove('hidden');
      box.innerHTML = `<div class="bg-blue-50 border-l-4 border-blue-400 text-blue-800 p-3 rounded">Generando explicaci√≥n con IA...</div>`;
      try {
        const resp = await fetch('/api/gemini-feedback', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ pregunta: `Explica el objetivo: ${objetivo}`, respuestaDocente: 'Explica con ejemplos, errores comunes y estrategias did√°cticas.', tema })
        });
        const data = await resp.json();
        if (!resp.ok) throw new Error(data.error || 'Error');
        box.innerHTML = `<div class="bg-white border p-3 rounded shadow-sm"><div class="prose prose-sm max-w-none">${(data.feedback || '').replace(/\n/g, '<br>')}</div></div>`;
      } catch (e) {
        box.innerHTML = `<div class="bg-red-50 border-l-4 border-red-400 text-red-800 p-3 rounded">No se pudo generar la explicaci√≥n. ${e.message || ''}</div>`;
      }
    }

    const btnCaso = ev.target.closest('.ia-explain-caso');
    if (btnCaso) {
      const pregunta = btnCaso.getAttribute('data-pregunta') || '';
      const respuestaDocente = btnCaso.getAttribute('data-respuesta') || '';
      const tema = btnCaso.getAttribute('data-tema') || '';
      const box = btnCaso.parentElement.nextElementSibling; // .ia-caso-box
      if (!box) return;
      box.classList.remove('hidden');
      box.innerHTML = `<div class="bg-blue-50 border-l-4 border-blue-400 text-blue-800 p-3 rounded">Justificando con IA...</div>`;
      try {
        const resp = await fetch('/api/gemini-feedback', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ pregunta, respuestaDocente, tema })
        });
        const data = await resp.json();
        if (!resp.ok) throw new Error(data.error || 'Error');
        box.innerHTML = `<div class="bg-white border p-3 rounded shadow-sm"><div class="prose prose-sm max-w-none">${(data.feedback || '').replace(/\n/g, '<br>')}</div></div>`;
      } catch (e) {
        box.innerHTML = `<div class="bg-red-50 border-l-4 border-red-400 text-red-800 p-3 rounded">No se pudo justificar con IA. ${e.message || ''}</div>`;
      }
    }
  });
</script>
<style>
  /* Estilos de impresi√≥n b√°sicos para exportar PDF desde el navegador */
  @media print {
    header, footer, nav, #mobile-menu, .btn-premium { display: none !important; }
    main { padding: 0 !important; }
    a[href]:after { content: "" !important; }
    .shadow, .shadow-sm, .shadow-md, .shadow-lg { box-shadow: none !important; }
    .border { border-color: #ddd !important; }
    .container, .mx-auto, .max-w-5xl { width: 100% !important; max-width: 100% !important; }
    .rounded, .rounded-lg, .rounded-2xl { border-radius: 0 !important; }
    .bg-gray-50, .bg-white { background: #fff !important; }
  }
</style>
<script>
  // Salud del endpoint IA: deshabilitar botones si no hay API Key
  document.addEventListener('DOMContentLoaded', async () => {
    try {
      const resp = await fetch('/api/gemini-feedback?health=1');
      const data = await resp.json();
      if (!data?.hasKey) {
        document.querySelectorAll('.ia-explain-obj, .ia-explain-caso').forEach(btn => {
          btn.disabled = true;
          btn.classList.add('opacity-60', 'cursor-not-allowed');
          btn.title = 'IA deshabilitada temporalmente (falta configuraci√≥n del servidor)';
        });
      }
    } catch {}
  });

  // Imprimir / Exportar PDF
  document.getElementById('btn-print')?.addEventListener('click', () => window.print());
</script>
