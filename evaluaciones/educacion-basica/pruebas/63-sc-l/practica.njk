---
layout: layout.njk
title: "Pr谩ctica Interactiva: Lenguaje y Comunicaci贸n"
description: "Responde las preguntas de la prueba 63-sc-l y prep谩rate para tu evaluaci贸n."
---

<div class="min-h-screen bg-gray-50">
  <div class="container mx-auto px-4 py-12">
    <div class="max-w-4xl mx-auto">

      <!-- Encabezado -->
      <div class="text-center mb-10">
        <h1 class="text-4xl md:text-5xl font-bold text-gray-800 mb-3"> Pr谩ctica Interactiva</h1>
        <p class="text-lg text-gray-600">Prueba 63-sc-l: Lenguaje y Comunicaci贸n</p>
        <a href="/evaluaciones/educacion-basica/pruebas/63-sc-l/" class="mt-4 inline-block text-purple-600 hover:text-purple-800">&larr; Volver</a>
      </div>

      <!-- Contenedor del Quiz -->
      <div id="quiz-container" class="bg-white rounded-2xl shadow-lg p-6 md:p-8">
        <form id="quiz-form">
          {% for pregunta in plan.exam.preguntas %}
            <div class="mb-8 pb-8 border-b border-gray-200 last:border-b-0" id="pregunta-{{ loop.index }}">
              <p class="text-lg font-semibold text-gray-800 mb-4">{{ loop.index }}. {{ pregunta.enunciado | safe }}</p>
              <div class="space-y-3">
                {% for alternativa in pregunta.alternativas %}
                  <label class="flex items-center p-4 border rounded-lg hover:bg-gray-50 cursor-pointer transition-colors">
                    <input type="radio" name="pregunta-{{ loop.parent.loop.index }}" value="{{ alternativa.opcion }}" class="h-5 w-5 text-purple-600 focus:ring-purple-500 border-gray-300">
                    <span class="ml-4 text-gray-700">{{ alternativa.opcion }}) {{ alternativa.texto }}</span>
                  </label>
                {% endfor %}
              </div>
              <div id="feedback-{{ loop.index }}" class="mt-4 hidden"></div>
              <div class="mt-3" id="justify-actions-{{ loop.index }}">
                <button type="button" data-q="{{ loop.index }}" class="ia-btn bg-blue-600 hover:bg-blue-700 text-white text-xs font-semibold py-2 px-3 rounded-md">
                  Ver justificaci贸n con IA
                </button>
              </div>
              <div id="ia-feedback-{{ loop.index }}" class="mt-3 hidden"></div>
              <div class="mt-3 hidden" id="ia-actions-{{ loop.index }}">
                <button type="button" data-q="{{ loop.index }}" class="ia-btn bg-green-600 hover:bg-green-700 text-white text-sm font-semibold py-2 px-4 rounded-md">
                  Obtener retroalimentaci贸n con IA
                </button>
              </div>
              <div id="ia-feedback-{{ loop.index }}" class="mt-3 hidden"></div>
            </div>
          {% endfor %}
          
          <div class="mt-8 text-center">
            <button type="submit" class="bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-8 rounded-lg shadow-md transition-transform transform hover:scale-105">
              Revisar mis respuestas
            </button>
          </div>
        </form>
        <div id="resultado-final" class="hidden mt-8 text-center">
            <h2 class="text-3xl font-bold text-gray-800">Resultados</h2>
            <p class="text-xl mt-2">Has respondido <span id="puntaje"></span> de {{ plan.exam.preguntas.length }} preguntas correctamente.</p>
        </div>
      </div>

    </div>
  </div>
</div>

<script>
  const plan = {{ plan | dump | safe }};
  const quizForm = document.getElementById('quiz-form');

  quizForm.addEventListener('submit', function(event) {
    event.preventDefault();
    
    let puntaje = 0;
    const totalPreguntas = plan.exam.preguntas.length;

    plan.exam.preguntas.forEach((pregunta, index) => {
      const preguntaIndex = index + 1;
      const feedbackEl = document.getElementById(`feedback-${preguntaIndex}`);
      const iaActionsEl = document.getElementById(`ia-actions-${preguntaIndex}`);
  const selectedOption = document.querySelector(`input[name="pregunta-${preguntaIndex}"]:checked`);
      
      feedbackEl.classList.remove('hidden');
      
      if (selectedOption) {
        const esCorrecta = selectedOption.value === pregunta.respuesta_correcta;
        if (esCorrecta) {
          puntaje++;
          feedbackEl.innerHTML = `
            <div class="bg-green-100 border-l-4 border-green-500 text-green-800 p-4 rounded-md">
              <p class="font-bold">隆Correcto!</p>
              <p>${pregunta.explicacion}</p>
            </div>
          `;
          // IA disponible igual para justificar por qu茅 es correcta
          iaActionsEl?.classList.remove('hidden');
        } else {
          feedbackEl.innerHTML = `
            <div class="bg-red-100 border-l-4 border-red-500 text-red-800 p-4 rounded-md">
              <p class="font-bold">Incorrecto.</p>
              <p>La respuesta correcta es la <strong>${pregunta.respuesta_correcta}</strong>.</p>
              <p>${pregunta.explicacion}</p>
            </div>
          `;
          // Mostrar acci贸n IA para retroalimentaci贸n adicional
          iaActionsEl?.classList.remove('hidden');
        }
      } else {
        feedbackEl.innerHTML = `
          <div class="bg-yellow-100 border-l-4 border-yellow-500 text-yellow-800 p-4 rounded-md">
            <p class="font-bold">No respondida.</p>
            <p>La respuesta correcta es la <strong>${pregunta.respuesta_correcta}</strong>.</p>
          </div>
        `;
  // Sugerir IA incluso si no respondi贸
  iaActionsEl?.classList.remove('hidden');
      }
    });

    const resultadoFinalEl = document.getElementById('resultado-final');
    document.getElementById('puntaje').textContent = puntaje;
    resultadoFinalEl.classList.remove('hidden');
    
    // Desplazar a los resultados
    resultadoFinalEl.scrollIntoView({ behavior: 'smooth' });
  });

  // Delegaci贸n de eventos para botones IA (en preguntas con error o acierto)
  document.addEventListener('click', async (ev) => {
    const btn = ev.target.closest('.ia-btn');
    if (!btn) return;
    const qIndex = Number(btn.getAttribute('data-q'));
    const pregunta = plan.exam.preguntas[qIndex - 1];
    const selected = document.querySelector(`input[name="pregunta-${qIndex}"]:checked`);
    const iaBox = document.getElementById(`ia-feedback-${qIndex}`);
    iaBox.classList.remove('hidden');
    iaBox.innerHTML = `
      <div class="bg-blue-50 border-l-4 border-blue-400 text-blue-800 p-4 rounded-md">
        Generando retroalimentaci贸n con IA...
      </div>
    `;

    const respuestaDocente = selected
      ? `${selected.value}) ${pregunta.alternativas.find(a => a.opcion === selected.value)?.texto || ''}`
      : 'Sin respuesta';
    const tema = (pregunta.temas_relacionados && pregunta.temas_relacionados[0]) || '';

    try {
      const resp = await fetch('/api/gemini-feedback', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ pregunta: pregunta.enunciado, respuestaDocente, tema })
      });
      const data = await resp.json();
      if (!resp.ok) throw new Error(data.error || 'Error');
      const text = data.feedback || 'No se recibi贸 retroalimentaci贸n.';
      iaBox.innerHTML = `
        <div class="bg-white border border-blue-200 p-4 rounded-md shadow-sm">
          <h4 class="font-semibold text-blue-700 mb-2">Retroalimentaci贸n de IA</h4>
          <div class="prose prose-sm max-w-none">${text.replace(/\n/g, '<br>')}</div>
        </div>
      `;
    } catch (e) {
      iaBox.innerHTML = `
        <div class="bg-red-50 border-l-4 border-red-400 text-red-800 p-4 rounded-md">
          No se pudo obtener retroalimentaci贸n. ${e.message || ''}
        </div>
      `;
    }
  });

  // Bloque opcional: recomendaciones de casos tras resultados
  // (Se podr铆an mostrar 3 preguntas variadas)
  // Este bloque puede ampliarse luego con selecci贸n por tema.
</script>
