---
layout: base.njk
title: Educaci√≥n Parvularia - Evaluaci√≥n ECEP 2025
pagination:
  data: collections.all
  size: 1
  addAllPagesToCollections: true
permalink: /evaluaciones/parvularia/pruebas/niveles-transicion/
eleventyNavigation:
  key: Parvularia NT
  parent: Evaluaciones Parvularia
  order: 1
---

{% set evaluacionData = collections.all | getEvaluacionData("parv-nt") %}

<style>
  .parv-card {
    border-radius: 15px;
    border: 3px solid;
    transition: transform 0.2s, box-shadow 0.2s;
  }
  .parv-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 20px rgba(0,0,0,0.15) !important;
  }
  .ambito-personal-social { border-color: #ff6b9d; background: linear-gradient(135deg, #fff5f7 0%, #ffe5eb 100%); }
  .ambito-comunicacion { border-color: #4ecdc4; background: linear-gradient(135deg, #f0fffe 0%, #d9f9f7 100%); }
  .ambito-entorno { border-color: #95e1d3; background: linear-gradient(135deg, #f5fffe 0%, #e0f9f4 100%); }
  .ambito-caso { border-color: #f7b731; background: linear-gradient(135deg, #fffdf5 0%, #fff8e1 100%); }
  
  .badge-nucleo {
    font-size: 0.85rem;
    padding: 0.5em 1em;
    border-radius: 20px;
    font-weight: 600;
  }
  
  .retroalimentacion-ia {
    border-radius: 12px;
    border-left: 5px solid #6c5ce7;
    background: linear-gradient(135deg, #f8f7ff 0%, #f0eeff 100%);
  }
  
  .pregunta-numero {
    font-size: 1.5rem;
    font-weight: 800;
    color: #fff;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 50%;
    width: 50px;
    height: 50px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
  }
  
  .form-check-input:checked {
    background-color: #667eea;
    border-color: #667eea;
  }
  
  .btn-revisar {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border: none;
    border-radius: 30px;
    padding: 1rem 3rem;
    font-size: 1.2rem;
    font-weight: 700;
    color: white;
    box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
    transition: all 0.3s;
  }
  
  .btn-revisar:hover {
    transform: translateY(-3px);
    box-shadow: 0 10px 30px rgba(102, 126, 234, 0.6);
  }
</style>

<div class="container py-5">
  <div class="row">
    <div class="col-lg-11 mx-auto">
      
      <!-- Header -->
      <div class="text-center mb-5">
        <h1 class="display-4 fw-bold" style="color: #667eea;">
          üé® Educaci√≥n Parvularia - Niveles de Transici√≥n
        </h1>
        <p class="lead" style="color: #764ba2;">Evaluaci√≥n Estandarizada ECEP 2025</p>
        <p class="text-secondary fs-5">
          <span class="badge" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">C√≥digo: parv-nt</span>
          <span class="mx-2">‚Ä¢</span>
          <span>100 preguntas</span>
          <span class="mx-2">‚Ä¢</span>
          <span>120 minutos estimados</span>
        </p>
      </div>

      <!-- Distribuci√≥n por √Åmbito -->
      <div class="card mb-4 shadow-lg border-0" style="border-radius: 15px; overflow: hidden;">
        <div class="card-header text-white text-center py-3" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
          <h5 class="mb-0"><strong>üìä Distribuci√≥n por √Åmbitos de Aprendizaje</strong></h5>
        </div>
        <div class="card-body p-4">
          <div class="row g-3">
            <div class="col-md-4">
              <div class="p-3 rounded shadow-sm" style="background: linear-gradient(135deg, #fff5f7 0%, #ffe5eb 100%); border-left: 5px solid #ff6b9d;">
                <h6 class="fw-bold" style="color: #ff6b9d;">üíñ Desarrollo Personal y Social</h6>
                <p class="mb-1 small">Identidad y Autonom√≠a</p>
                <p class="mb-1 small">Convivencia y Ciudadan√≠a</p>
                <p class="mb-1 small">Corporalidad y Movimiento</p>
                <span class="badge bg-danger mt-2">25 preguntas</span>
              </div>
            </div>
            <div class="col-md-4">
              <div class="p-3 rounded shadow-sm" style="background: linear-gradient(135deg, #f0fffe 0%, #d9f9f7 100%); border-left: 5px solid #4ecdc4;">
                <h6 class="fw-bold" style="color: #4ecdc4;">üí¨ Comunicaci√≥n Integral</h6>
                <p class="mb-1 small">Lenguaje Verbal</p>
                <p class="mb-1 small">Lenguajes Art√≠sticos</p>
                <br>
                <span class="badge bg-info mt-2">25 preguntas</span>
              </div>
            </div>
            <div class="col-md-4">
              <div class="p-3 rounded shadow-sm" style="background: linear-gradient(135deg, #f5fffe 0%, #e0f9f4 100%); border-left: 5px solid #95e1d3;">
                <h6 class="fw-bold" style="color: #95e1d3;">üåç Interacci√≥n y Comprensi√≥n del Entorno</h6>
                <p class="mb-1 small">Exploraci√≥n del Entorno Natural</p>
                <p class="mb-1 small">Comprensi√≥n del Entorno Sociocultural</p>
                <p class="mb-1 small">Pensamiento Matem√°tico</p>
                <span class="badge bg-success mt-2">25 preguntas</span>
              </div>
            </div>
          </div>
          <div class="text-center mt-3">
            <div class="p-3 rounded shadow-sm d-inline-block" style="background: linear-gradient(135deg, #fffdf5 0%, #fff8e1 100%); border: 3px solid #f7b731;">
              <h6 class="fw-bold mb-2" style="color: #f7b731;">üìö 5 Casos de Estudio Integrados</h6>
              <span class="badge bg-warning text-dark">25 preguntas</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Barra de Progreso -->
      <div class="card mb-4 shadow-sm border-0" style="border-radius: 15px;">
        <div class="card-body p-4">
          <div class="d-flex justify-content-between align-items-center mb-3">
            <h5 class="mb-0 fw-bold">üöÄ Tu progreso</h5>
            <span id="progreso-texto" class="badge fs-6" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">0 / 100 respondidas</span>
          </div>
          <div class="progress" style="height: 30px; border-radius: 15px;">
            <div id="barra-progreso" class="progress-bar progress-bar-striped progress-bar-animated" 
                 role="progressbar" style="width: 0%; border-radius: 15px; background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);" 
                 aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
              <span class="fw-bold">0%</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Instrucciones -->
      <div class="card mb-5 border-0 shadow-lg" style="border-radius: 15px; overflow: hidden;">
        <div class="card-header text-white py-3" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
          <h5 class="mb-0">üìã <strong>Instrucciones</strong></h5>
        </div>
        <div class="card-body p-4">
          <ul class="mb-0" style="line-height: 2;">
            <li>Lee atentamente cada pregunta antes de seleccionar tu respuesta</li>
            <li>Marca <strong>UNA sola alternativa</strong> (A, B, C o D) por pregunta</li>
            <li>Las preguntas 1-75 eval√∫an conocimientos pedag√≥gicos por n√∫cleo de aprendizaje</li>
            <li>Las preguntas 76-100 est√°n integradas en <strong>5 casos de estudio contextualizados</strong></li>
            <li>Puedes cambiar tus respuestas antes de revisar</li>
            <li>Al finalizar, presiona <strong>"Revisar respuestas"</strong> para obtener retroalimentaci√≥n pedag√≥gica</li>
            <li><strong>üí° Apoyo IA disponible:</strong> Despu√©s de revisar, podr√°s obtener explicaciones personalizadas</li>
          </ul>
        </div>
      </div>

      <!-- Formulario de Evaluaci√≥n -->
      <form id="formulario-evaluacion">
        
        <!-- PREGUNTAS 1-75 -->
        {% for pregunta in evaluacionData.exam.preguntas %}
        
        {% if pregunta.numero == 1 %}
        <h2 class="text-center mb-4 mt-5" style="color: #667eea;">
          <span class="badge" style="background: linear-gradient(135deg, #ff6b9d 0%, #ff8fab 100%); font-size: 1.3rem; padding: 0.7em 1.5em;">
            Parte I: Desarrollo Personal y Social (1-25)
          </span>
        </h2>
        {% endif %}
        
        {% if pregunta.numero == 26 %}
        <h2 class="text-center mb-4 mt-5" style="color: #667eea;">
          <span class="badge" style="background: linear-gradient(135deg, #4ecdc4 0%, #44a6a0 100%); font-size: 1.3rem; padding: 0.7em 1.5em;">
            Parte II: Comunicaci√≥n Integral (26-50)
          </span>
        </h2>
        {% endif %}
        
        {% if pregunta.numero == 51 %}
        <h2 class="text-center mb-4 mt-5" style="color: #667eea;">
          <span class="badge" style="background: linear-gradient(135deg, #95e1d3 0%, #7ac5b5 100%); font-size: 1.3rem; padding: 0.7em 1.5em;">
            Parte III: Interacci√≥n y Comprensi√≥n del Entorno (51-75)
          </span>
        </h2>
        {% endif %}
        
        {% if pregunta.numero == 76 %}
        <h2 class="text-center mb-4 mt-5" style="color: #667eea;">
          <span class="badge" style="background: linear-gradient(135deg, #f7b731 0%, #e59a1c 100%); font-size: 1.3rem; padding: 0.7em 1.5em;">
            Parte IV: Casos de Estudio Integrados (76-100)
          </span>
        </h2>
        {% endif %}

        <div class="card parv-card mb-4 shadow-sm 
          {% if pregunta.ambito contains 'Desarrollo Personal y Social' %}ambito-personal-social{% endif %}
          {% if pregunta.ambito contains 'Comunicaci√≥n Integral' %}ambito-comunicacion{% endif %}
          {% if pregunta.ambito contains 'Interacci√≥n y Comprensi√≥n del Entorno' %}ambito-entorno{% endif %}
          {% if pregunta.ambito contains 'Caso de Estudio' %}ambito-caso{% endif %}">
          
          <div class="card-header" style="background: rgba(255,255,255,0.7); border-bottom: 2px solid rgba(0,0,0,0.1);">
            <div class="d-flex justify-content-between align-items-center flex-wrap">
              <div class="d-flex align-items-center gap-3">
                <span class="pregunta-numero">{{ pregunta.numero }}</span>
                <div>
                  <span class="badge badge-nucleo 
                    {% if pregunta.nucleo == 'Identidad y Autonom√≠a' %}bg-danger{% endif %}
                    {% if pregunta.nucleo == 'Convivencia y Ciudadan√≠a' %}bg-primary{% endif %}
                    {% if pregunta.nucleo == 'Corporalidad y Movimiento' %}bg-success{% endif %}
                    {% if pregunta.nucleo == 'Lenguaje Verbal' %}bg-info{% endif %}
                    {% if pregunta.nucleo == 'Lenguajes Art√≠sticos' %}bg-warning text-dark{% endif %}
                    {% if pregunta.nucleo == 'Exploraci√≥n del Entorno Natural' %}bg-success{% endif %}
                    {% if pregunta.nucleo == 'Comprensi√≥n del Entorno Sociocultural' %}text-white{% endif %}
                    {% if pregunta.nucleo == 'Pensamiento Matem√°tico' %}bg-dark{% endif %}
                    {% if pregunta.nucleo contains 'Planificaci√≥n' or pregunta.nucleo contains 'Atenci√≥n' or pregunta.nucleo contains 'Evaluaci√≥n' or pregunta.nucleo contains 'Alianza' or pregunta.nucleo contains 'Convivencia y Mediaci√≥n' %}bg-warning text-dark{% endif %}" 
                    style="{% if pregunta.nucleo == 'Comprensi√≥n del Entorno Sociocultural' %}background: linear-gradient(135deg, #20bf6b 0%, #26de81 100%);{% endif %}">
                    {{ pregunta.nucleo }}
                  </span>
                </div>
              </div>
              <small class="text-muted mt-2 mt-md-0">{{ pregunta.habilidad }}</small>
            </div>
          </div>
          
          <div class="card-body p-4">
            <p class="fw-bold mb-4 fs-5" style="line-height: 1.7;">{{ pregunta.enunciado }}</p>
            
            <div class="opciones">
              {% for alt in pregunta.alternativas %}
              <div class="form-check mb-3 p-3 rounded" style="background: rgba(255,255,255,0.7); border: 2px solid transparent; transition: all 0.2s;">
                <input class="form-check-input" type="radio" 
                       name="pregunta-{{ pregunta.id }}" 
                       id="{{ pregunta.id }}-{{ alt.letra }}" 
                       value="{{ alt.letra }}"
                       data-correcta="{{ pregunta.respuesta_correcta }}"
                       data-explicacion="{{ pregunta.explicacion }}"
                       data-pregunta-num="{{ pregunta.numero }}"
                       style="width: 1.5em; height: 1.5em; margin-top: 0.25em;">
                <label class="form-check-label w-100 ms-2" for="{{ pregunta.id }}-{{ alt.letra }}" style="cursor: pointer; line-height: 1.6;">
                  <strong class="fs-5" style="color: #667eea;">{{ alt.letra }})</strong> {{ alt.texto }}
                </label>
              </div>
              {% endfor %}
            </div>

            <!-- √Årea de retroalimentaci√≥n (oculta inicialmente) -->
            <div class="alert mt-4 d-none retroalimentacion" role="alert"></div>
            
            <!-- Bot√≥n IA (aparece despu√©s de revisar) -->
            <div class="mt-3 d-none btn-ia-container">
              <button type="button" class="btn btn-sm btn-outline-secondary btn-consultar-ia" 
                      data-pregunta-num="{{ pregunta.numero }}"
                      data-nucleo="{{ pregunta.nucleo }}">
                <i class="bi bi-stars"></i> üí° Consultar IA sobre esta pregunta
              </button>
              <div class="retroalimentacion-ia mt-3 p-3 d-none">
                <div class="d-flex align-items-start">
                  <span class="me-2" style="font-size: 1.5rem;">ü§ñ</span>
                  <div class="ia-content flex-grow-1">
                    <strong style="color: #6c5ce7;">Retroalimentaci√≥n IA:</strong>
                    <div class="ia-response mt-2"></div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        {% endfor %}

        <!-- Bot√≥n Revisar -->
        <div class="text-center my-5 py-4">
          <button type="button" id="btn-revisar" class="btn btn-revisar">
            ‚úÖ Revisar respuestas
          </button>
        </div>

      </form>

      <!-- Resultados (oculto inicialmente) -->
      <div id="resultados-container" class="d-none">
        <div class="card border-0 shadow-lg" style="border-radius: 20px; overflow: hidden;">
          <div class="card-header text-white text-center py-4" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
            <h3 class="mb-0 fw-bold">üéâ Resultados de tu Evaluaci√≥n</h3>
          </div>
          <div class="card-body p-5">
            <div class="row text-center mb-4">
              <div class="col-md-4 mb-3">
                <div class="p-4 rounded shadow-sm" style="background: linear-gradient(135deg, #e0f7fa 0%, #b2ebf2 100%);">
                  <h2 class="display-3 fw-bold" id="puntaje-total" style="color: #00acc1;">0/100</h2>
                  <p class="text-muted mb-0 fw-bold">Respuestas correctas</p>
                </div>
              </div>
              <div class="col-md-4 mb-3">
                <div class="p-4 rounded shadow-sm" style="background: linear-gradient(135deg, #f3e5f5 0%, #e1bee7 100%);">
                  <h2 class="display-3 fw-bold" id="porcentaje-total" style="color: #8e24aa;">0%</h2>
                  <p class="text-muted mb-0 fw-bold">Porcentaje de logro</p>
                </div>
              </div>
              <div class="col-md-4 mb-3">
                <div class="p-4 rounded shadow-sm" style="background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%);">
                  <h2 class="display-3 fw-bold" id="nota-estimada" style="color: #f57c00;">1.0</h2>
                  <p class="text-muted mb-0 fw-bold">Nota estimada (1-7)</p>
                </div>
              </div>
            </div>

            <hr class="my-4">

            <h5 class="text-center mb-4 fw-bold" style="color: #667eea;">üìä Resultados por √Åmbito</h5>
            <div class="row g-3" id="resultados-ambitos">
              <!-- Se generar√° din√°micamente con JavaScript -->
            </div>

            <div class="alert alert-info mt-4 rounded shadow-sm" style="border-left: 5px solid #667eea; background: linear-gradient(135deg, #f8f7ff 0%, #f0eeff 100%);">
              <strong>üí° Sugerencia pedag√≥gica:</strong> Revisa las explicaciones de las preguntas que respondiste incorrectamente (marcadas en rojo). Presta especial atenci√≥n a los principios de las Bases Curriculares de Educaci√≥n Parvularia.
            </div>
          </div>
        </div>
      </div>

      <!-- Navegaci√≥n -->
      <div class="text-center mt-5 pt-4">
        <a href="/evaluaciones/" class="btn btn-outline-secondary btn-lg" style="border-radius: 25px;">
          ‚Üê Volver a Evaluaciones
        </a>
      </div>

    </div>
  </div>
</div>

<!-- Script de correcci√≥n y retroalimentaci√≥n -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  const form = document.getElementById('formulario-evaluacion');
  const btnRevisar = document.getElementById('btn-revisar');
  const barraProgreso = document.getElementById('barra-progreso');
  const progresoTexto = document.getElementById('progreso-texto');
  const resultadosContainer = document.getElementById('resultados-container');
  
  const totalPreguntas = 100;
  let respuestasSeleccionadas = 0;
  let evaluacionRevisada = false;

  // Actualizar progreso al seleccionar opciones
  form.addEventListener('change', function(e) {
    if (e.target.type === 'radio') {
      actualizarProgreso();
      
      // Efecto visual al seleccionar
      const label = e.target.closest('.form-check');
      label.style.borderColor = '#667eea';
      label.style.backgroundColor = 'rgba(102, 126, 234, 0.1)';
    }
  });

  function actualizarProgreso() {
    const radiosSeleccionados = form.querySelectorAll('input[type="radio"]:checked');
    respuestasSeleccionadas = new Set([...radiosSeleccionados].map(r => r.name)).size;
    
    const porcentaje = Math.round((respuestasSeleccionadas / totalPreguntas) * 100);
    
    barraProgreso.style.width = porcentaje + '%';
    barraProgreso.querySelector('span').textContent = porcentaje + '%';
    barraProgreso.setAttribute('aria-valuenow', respuestasSeleccionadas);
    
    progresoTexto.textContent = `${respuestasSeleccionadas} / ${totalPreguntas} respondidas`;
  }

  // Revisar respuestas
  btnRevisar.addEventListener('click', function() {
    if (respuestasSeleccionadas < totalPreguntas) {
      if (!confirm(`Has respondido ${respuestasSeleccionadas} de ${totalPreguntas} preguntas. ¬øDeseas revisar de todos modos?`)) {
        return;
      }
    }

    corregirEvaluacion();
    evaluacionRevisada = true;
    btnRevisar.disabled = true;
    btnRevisar.textContent = '‚úÖ Evaluaci√≥n revisada';
    btnRevisar.style.background = 'linear-gradient(135deg, #95e1d3 0%, #7ac5b5 100%)';
    
    // Mostrar botones de IA
    document.querySelectorAll('.btn-ia-container').forEach(container => {
      container.classList.remove('d-none');
    });
    
    // Scroll suave a resultados
    setTimeout(() => {
      resultadosContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }, 800);
  });

  function corregirEvaluacion() {
    const radiosSeleccionados = form.querySelectorAll('input[type="radio"]:checked');
    let correctas = 0;
    
    const resultadosPorAmbito = {
      'Desarrollo Personal y Social': { correctas: 0, total: 25, color: '#ff6b9d' },
      'Comunicaci√≥n Integral': { correctas: 0, total: 25, color: '#4ecdc4' },
      'Interacci√≥n y Comprensi√≥n del Entorno': { correctas: 0, total: 25, color: '#95e1d3' },
      'Casos de Estudio': { correctas: 0, total: 25, color: '#f7b731' }
    };

    // Recorrer todas las preguntas
    const todasLasPreguntas = form.querySelectorAll('.parv-card');
    todasLasPreguntas.forEach((preguntaCard) => {
      const radios = preguntaCard.querySelectorAll('input[type="radio"]');
      const radioSeleccionado = preguntaCard.querySelector('input[type="radio"]:checked');
      const retroalimentacionDiv = preguntaCard.querySelector('.retroalimentacion');
      
      if (radios.length === 0) return;
      
      const respuestaCorrecta = radios[0].dataset.correcta;
      const explicacion = radios[0].dataset.explicacion;
      const preguntaNum = parseInt(radios[0].dataset.preguntaNum);
      
      // Determinar √°mbito
      let ambito = 'Casos de Estudio';
      if (preguntaNum <= 25) ambito = 'Desarrollo Personal y Social';
      else if (preguntaNum <= 50) ambito = 'Comunicaci√≥n Integral';
      else if (preguntaNum <= 75) ambito = 'Interacci√≥n y Comprensi√≥n del Entorno';

      if (radioSeleccionado) {
        const esCorrecta = radioSeleccionado.value === respuestaCorrecta;
        
        if (esCorrecta) {
          correctas++;
          resultadosPorAmbito[ambito].correctas++;
          
          // Retroalimentaci√≥n positiva
          retroalimentacionDiv.classList.remove('d-none', 'alert-danger');
          retroalimentacionDiv.classList.add('alert-success');
          retroalimentacionDiv.innerHTML = `
            <strong>‚úÖ ¬°Correcto!</strong><br>
            <p class="mb-0 mt-2">${explicacion}</p>
          `;
          
          // Marcar visualmente la opci√≥n correcta
          const labelSeleccionado = radioSeleccionado.closest('.form-check');
          labelSeleccionado.style.borderColor = '#28a745';
          labelSeleccionado.style.backgroundColor = 'rgba(40, 167, 69, 0.1)';
          
        } else {
          // Retroalimentaci√≥n de error
          retroalimentacionDiv.classList.remove('d-none', 'alert-success');
          retroalimentacionDiv.classList.add('alert-danger');
          retroalimentacionDiv.innerHTML = `
            <strong>‚ùå Incorrecto</strong><br>
            <p class="mb-2 mt-2"><strong>Respuesta correcta:</strong> ${respuestaCorrecta}</p>
            <p class="mb-0"><strong>Explicaci√≥n:</strong> ${explicacion}</p>
          `;
          
          // Marcar visualmente la opci√≥n incorrecta
          const labelSeleccionado = radioSeleccionado.closest('.form-check');
          labelSeleccionado.style.borderColor = '#dc3545';
          labelSeleccionado.style.backgroundColor = 'rgba(220, 53, 69, 0.1)';
          
          // Resaltar la opci√≥n correcta
          radios.forEach(radio => {
            if (radio.value === respuestaCorrecta) {
              const labelCorrecto = radio.closest('.form-check');
              labelCorrecto.style.borderColor = '#28a745';
              labelCorrecto.style.backgroundColor = 'rgba(40, 167, 69, 0.15)';
            }
          });
        }
      } else {
        // No respondida
        retroalimentacionDiv.classList.remove('d-none', 'alert-success', 'alert-danger');
        retroalimentacionDiv.classList.add('alert-warning');
        retroalimentacionDiv.innerHTML = `
          <strong>‚ö†Ô∏è No respondida</strong><br>
          <p class="mb-2 mt-2"><strong>Respuesta correcta:</strong> ${respuestaCorrecta}</p>
          <p class="mb-0">${explicacion}</p>
        `;
        
        // Resaltar la opci√≥n correcta
        radios.forEach(radio => {
          if (radio.value === respuestaCorrecta) {
            const labelCorrecto = radio.closest('.form-check');
            labelCorrecto.style.borderColor = '#28a745';
            labelCorrecto.style.backgroundColor = 'rgba(40, 167, 69, 0.15)';
          }
        });
      }
    });

    // Mostrar resultados generales
    const porcentaje = Math.round((correctas / totalPreguntas) * 100);
    const nota = calcularNota(porcentaje);
    
    document.getElementById('puntaje-total').textContent = `${correctas}/100`;
    document.getElementById('porcentaje-total').textContent = `${porcentaje}%`;
    document.getElementById('nota-estimada').textContent = nota.toFixed(1);
    
    // Cambiar color de nota seg√∫n desempe√±o
    const notaElement = document.getElementById('nota-estimada');
    if (nota >= 6.0) notaElement.style.color = '#28a745';
    else if (nota >= 5.0) notaElement.style.color = '#007bff';
    else if (nota >= 4.0) notaElement.style.color = '#ffc107';
    else notaElement.style.color = '#dc3545';

    // Mostrar resultados por √°mbito
    const resultadosAmbitosDiv = document.getElementById('resultados-ambitos');
    resultadosAmbitosDiv.innerHTML = '';
    
    for (const [ambito, datos] of Object.entries(resultadosPorAmbito)) {
      const porcentajeAmbito = Math.round((datos.correctas / datos.total) * 100);
      
      const col = document.createElement('div');
      col.className = 'col-md-6 mb-3';
      col.innerHTML = `
        <div class="p-3 rounded shadow-sm" style="border-left: 5px solid ${datos.color}; background: rgba(255,255,255,0.7);">
          <h6 class="fw-bold mb-2" style="color: ${datos.color};">${ambito}</h6>
          <div class="d-flex justify-content-between align-items-center">
            <span class="fw-bold">${datos.correctas}/${datos.total} correctas</span>
            <span class="badge ${porcentajeAmbito >= 60 ? 'bg-success' : porcentajeAmbito >= 40 ? 'bg-warning text-dark' : 'bg-danger'}">${porcentajeAmbito}%</span>
          </div>
          <div class="progress mt-2" style="height: 8px;">
            <div class="progress-bar" role="progressbar" 
                 style="width: ${porcentajeAmbito}%; background-color: ${datos.color};" 
                 aria-valuenow="${porcentajeAmbito}" aria-valuemin="0" aria-valuemax="100"></div>
          </div>
        </div>
      `;
      resultadosAmbitosDiv.appendChild(col);
    }

    resultadosContainer.classList.remove('d-none');
  }

  function calcularNota(porcentaje) {
    // Escala 60% = 4.0, 100% = 7.0
    if (porcentaje < 60) {
      return 1.0 + (porcentaje / 60) * 3.0;
    } else {
      return 4.0 + ((porcentaje - 60) / 40) * 3.0;
    }
  }

  // Consultar IA
  document.addEventListener('click', function(e) {
    if (e.target.closest('.btn-consultar-ia')) {
      const btn = e.target.closest('.btn-consultar-ia');
      const preguntaNum = btn.dataset.preguntaNum;
      const nucleo = btn.dataset.nucleo;
      const iaContainer = btn.nextElementSibling;
      const iaResponse = iaContainer.querySelector('.ia-response');
      
      // Mostrar loading
      iaContainer.classList.remove('d-none');
      iaResponse.innerHTML = '<div class="spinner-border spinner-border-sm me-2" role="status"></div>Consultando IA...';
      btn.disabled = true;
      
      // Simular llamada a IA (aqu√≠ integrar√≠as con Gemini API)
      setTimeout(() => {
        iaResponse.innerHTML = `
          <p class="mb-2">Para profundizar en esta pregunta sobre <strong>${nucleo}</strong>, te recomiendo:</p>
          <ul class="mb-0">
            <li>Revisar las Bases Curriculares de Educaci√≥n Parvularia 2018, espec√≠ficamente el √°mbito y n√∫cleo correspondiente</li>
            <li>Reflexionar sobre c√≥mo esta situaci√≥n se presenta en tu pr√°ctica pedag√≥gica diaria</li>
            <li>Considerar el enfoque constructivista y el protagonismo del ni√±o en el aprendizaje</li>
            <li>Conectar con principios de juego, exploraci√≥n y respeto por los ritmos individuales</li>
          </ul>
          <p class="mt-2 mb-0 small text-muted">üí° Esta retroalimentaci√≥n se basa en los prompts especializados de IA para Educaci√≥n Parvularia.</p>
        `;
      }, 1500);
    }
  });
});
</script>
