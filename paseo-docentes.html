---
layout: layout.njk
title: "Inscripción: Paseo de Docentes a la Playa 2025"
description: "Formulario de inscripción para el paseo de docentes a la playa - Viernes 08 de Noviembre"
---

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inscripción Interactiva: Paseo de Docentes a la Playa 2025</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .form-container {
            max-width: 900px;
            margin: 2rem auto;
            padding: 2rem;
            background-color: #ffffff;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        .info-box {
            background-color: #F3F4F6;
            border-left: 4px solid #3B82F6;
            padding: 1rem;
            margin-bottom: 1.5rem;
            border-radius: 8px;
        }
        .btn {
            background-color: #2563EB;
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-weight: 600;
            width: auto;
            min-width: 150px;
            transition: background-color 0.3s;
            cursor: pointer;
        }
        .btn:hover {
            background-color: #1D4ED8;
        }
        .btn:disabled {
            background-color: #9CA3AF;
            cursor: not-allowed;
        }
        .btn-secondary {
            background-color: #6B7281;
        }
        .btn-secondary:hover {
            background-color: #4B5563;
        }
         .btn-danger {
            background-color: #DC2626;
        }
        .btn-danger:hover {
            background-color: #B91C1C;
        }
        .bus-layout {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
            padding: 20px;
            background-color: #f0f0f0;
            border-radius: 10px;
            border: 2px solid #ccc;
        }
        .seat {
            height: 40px;
            background-color: #4CAF50;
            color: white;
            border-radius: 5px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.2s;
            position: relative;
        }
        .seat.taken {
            background-color: #F44336;
            cursor: not-allowed;
        }
        .seat.mine {
            background-color: #FFC107;
            color: #333;
            border: 2px solid #FFA000;
        }
        .seat.taken .tooltip, .seat.mine .tooltip {
            visibility: visible;
            opacity: 1;
        }
        .seat:not(.taken):not(.mine):hover {
            background-color: #45a049;
        }
        .seat.aisle {
            background-color: transparent;
            border: none;
            cursor: default;
        }
        .seat .tooltip {
            visibility: hidden;
            width: max-content;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 5px 10px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s;
        }
        .seat .tooltip::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: #333 transparent transparent transparent;
        }
        .modal {
            position: fixed;
            z-index: 10;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .modal-content {
            background-color: #fefefe;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
            max-width: 400px;
            border-radius: 10px;
        }
        .step-section {
            padding: 1.5rem;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            margin-top: 1.5rem;
        }
    </style>
</head>
<body class="bg-gray-50">

    <div class="form-container">
        <!-- Encabezado -->
        <div class="text-center mb-8">
            <h1 class="text-3xl font-bold text-gray-800">Paseo de Docentes a la Playa</h1>
            <p class="text-xl font-semibold text-blue-600 mt-1">"Donde Gilberto" - Viernes, 08 de Noviembre</p>
        </div>

        <!-- Descripción -->
        <div class="info-box">
            <h2 class="font-bold text-gray-800 mb-2">Descripción de la Actividad</h2>
            <p class="text-gray-700 text-sm">
                Disfrutaremos de una jornada de camaradería y relajo. El día comenzará a las <strong>11:00 AM</strong> con un aperitivo de bienvenida, seguido de un delicioso almuerzo y, para finalizar, una once. Tendremos a nuestra disposición todas las instalaciones del recinto para compartir y descansar.
            </p>
        </div>

        <!-- Instrucción WhatsApp -->
        <div class="info-box border-l-amber-500 bg-amber-50">
            <h2 class="font-bold text-amber-800 mb-2">Instrucción Obligatoria</h2>
            <p class="text-amber-700 text-sm mb-4">
                Para mantener a todos informados sobre los detalles y cualquier novedad del paseo, es requisito unirse al grupo de difusión de WhatsApp.
            </p>
             <a href="https://chat.whatsapp.com/CVg4jRdMUcnJwQY0pBpWVg?mode=ems_copy_t" target="_blank" rel="noopener noreferrer" class="w-full flex items-center justify-center gap-3 p-3 rounded-lg bg-green-500 hover:bg-green-600 text-white font-bold transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12.04 2c-5.46 0-9.91 4.45-9.91 9.91 0 1.75.46 3.45 1.32 4.95L2 22l5.25-1.38c1.45.79 3.08 1.21 4.79 1.21 5.46 0 9.91-4.45 9.91-9.91S17.5 2 12.04 2zM12.04 20.15c-1.49 0-2.93-.4-4.19-1.15l-.3-.18-3.12.82.83-3.04-.2-.31c-.82-1.31-1.26-2.83-1.26-4.38 0-4.54 3.67-8.21 8.21-8.21 2.23 0 4.33.87 5.81 2.44s2.44 3.58 2.44 5.81c0 4.54-3.67 8.21-8.21 8.21zm4.49-5.32c-.24-.12-1.42-.7-1.64-.78-.23-.08-.39-.12-.56.12-.17.24-.62.78-.76.93-.14.16-.28.18-.52.06-.24-.12-1.02-.37-1.94-1.2-1.12-.99-1.55-1.85-1.7-2.17-.15-.31-.02-.48.1-.63.11-.13.24-.35.37-.52.12-.17.16-.28.24-.47.08-.19.04-.36-.02-.48s-.56-1.34-.76-1.84c-.2-.48-.41-.42-.56-.42h-.48c-.17 0-.44.06-.68.31-.24.24-.93.9-1.08 2.18-.15 1.28.62 2.52.71 2.69.09.17 1.8 2.74 4.36 3.82 2.56 1.08 2.56.72 3.03.69.46-.03 1.42-.58 1.62-1.14.2-.56.2-1.04.14-1.14-.06-.11-.23-.17-.47-.29z"/>
                </svg>
                Unirse al Grupo de WhatsApp
            </a>
        </div>
        
        <!-- Requisitos -->
        <div class="info-box border-l-red-500 bg-red-50">
            <h2 class="font-bold text-red-800 mb-2">Requisitos para Asistir</h2>
            <ul class="list-disc list-inside text-red-700 text-sm space-y-1">
                <li>Ser docente del Centro Educativo Salesianos Talca.</li>
                <li>Tener una antigüedad mínima de 3 meses en el establecimiento al día del evento (08 de noviembre).</li>
            </ul>
        </div>


        <!-- Contenido principal dinámico -->
        <div id="main-content">

            <!-- Paso 0: Datos Personales -->
            <div id="step0-personal-data" class="step-section">
                <h3 class="block mb-4 font-medium text-lg text-gray-800">Para comenzar, por favor completa tus datos:</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label for="fullNameInput" class="block text-sm font-medium text-gray-700">Nombre Completo</label>
                        <input type="text" id="fullNameInput" class="mt-1 w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="Nombre y Apellido" required>
                    </div>
                    <div>
                        <label for="rutInput" class="block text-sm font-medium text-gray-700">RUT</label>
                        <input type="text" id="rutInput" class="mt-1 w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="12.345.678-9" required>
                    </div>
                    <div class="md:col-span-2">
                        <label for="addressInput" class="block text-sm font-medium text-gray-700">Dirección</label>
                        <input type="text" id="addressInput" class="mt-1 w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="Calle Falsa 123, Comuna" required>
                    </div>
                    <div>
                        <label for="emergencyPhoneInput" class="block text-sm font-medium text-gray-700">Teléfono de Emergencia</label>
                        <input type="tel" id="emergencyPhoneInput" class="mt-1 w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="+56 9 1234 5678" required>
                    </div>
                    <div>
                        <label for="ageInput" class="block text-sm font-medium text-gray-700">Edad</label>
                        <input type="number" id="ageInput" class="mt-1 w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="Ej: 35" required>
                    </div>
                    <div>
                        <label for="genderInput" class="block text-sm font-medium text-gray-700">Género</label>
                        <select id="genderInput" class="mt-1 w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" required>
                            <option value="">Seleccione una opción</option>
                            <option value="Masculino">Masculino</option>
                            <option value="Femenino">Femenino</option>
                            <option value="Otro">Otro</option>
                            <option value="Prefiero no decir">Prefiero no decir</option>
                        </select>
                    </div>
                </div>
                <div class="mt-6 text-right">
                    <button class="btn" onclick="processPersonalData()">Guardar y Continuar</button>
                </div>
            </div>


            <!-- Paso 1: Asistencia -->
            <div id="step1-attendance" class="step-section hidden">
                <p class="block mb-3 font-medium text-lg text-gray-800">Hola <span id="userNameDisplay" class="font-bold"></span>, ¿asistirás a la actividad?</p>
                <div class="flex items-center space-x-6">
                    <button class="btn" onclick="handleAttendance(true)">Sí, asistiré</button>
                    <button class="btn btn-secondary" onclick="handleAttendance(false)">No, no puedo asistir</button>
                </div>
            </div>

            <!-- Paso 2: Transporte -->
            <div id="step2-transport" class="step-section hidden">
                <p class="block mb-3 font-medium text-lg text-gray-800">¡Genial! ¿Necesitarás transporte en el bus?</p>
                <div class="flex items-center space-x-6">
                    <button class="btn" onclick="handleTransport(true)">Sí, usaré el bus</button>
                    <button class="btn btn-secondary" onclick="handleTransport(false)">No, iré por mis medios</button>
                </div>
            </div>

            <!-- Paso 3: Selección de Asiento -->
            <div id="step3-bus-selection" class="hidden">
                 <h2 class="text-xl font-bold text-gray-800 my-4 text-center">Selección de Asientos en el Bus (46 Cupos)</h2>
                 <div class="flex flex-col md:flex-row gap-8">
                     <div class="w-full md:w-1/2">
                         <div class="bus-layout"></div>
                         <div class="flex justify-around mt-4 text-xs">
                             <div class="flex items-center"><span class="w-4 h-4 bg-green-500 rounded-full mr-2"></span> Disponible</div>
                             <div class="flex items-center"><span class="w-4 h-4 bg-red-500 rounded-full mr-2"></span> Ocupado</div>
                              <div class="flex items-center"><span class="w-4 h-4 bg-yellow-400 rounded-full mr-2"></span> Mi Asiento</div>
                         </div>
                     </div>
                     <div class="w-full md:w-1/2">
                         <h3 class="font-bold mb-2">Lista de Pasajeros:</h3>
                         <div id="passenger-list" class="h-64 overflow-y-auto bg-gray-50 p-3 rounded-lg border"></div>
                     </div>
                 </div>
            </div>
            
            <!-- Estados finales -->
            <div id="final-state-container" class="text-center p-6 bg-blue-50 border-l-4 border-blue-500 text-blue-800 rounded-lg mt-6 hidden">
                <p id="final-state-message" class="font-semibold"></p>
                <button id="reset-preference-btn" class="btn btn-danger mt-4" onclick="resetPreference()">Cambiar mi respuesta</button>
            </div>
        </div>
    </div>
    
    <!-- Modal para confirmar reserva -->
    <div id="confirmModal" class="modal hidden">
      <div class="modal-content">
        <h2 class="text-xl font-bold mb-4">Reservar Asiento <span id="seat-number-modal" class="text-blue-600"></span></h2>
        <p class="mb-4">¿Confirmas que quieres reservar este asiento?</p>
        <div class="flex justify-end gap-3">
             <button onclick="closeModal('confirmModal')" class="btn btn-secondary">Cancelar</button>
             <button onclick="reserveSeat()" class="btn">Confirmar</button>
        </div>
      </div>
    </div>
    
    <!-- Modal para aviso de beneficio del bus -->
    <div id="busBenefitModal" class="modal hidden">
      <div class="modal-content">
        <h2 class="text-xl font-bold mb-4 text-center text-blue-600">Aviso Importante</h2>
        <p class="mb-6 text-center text-gray-700">Si tienes quien te pueda llevar, por favor deja este beneficio para aquellos que no disponen de vehículo o de alguien que los lleve.</p>
        <div class="flex flex-col gap-3">
             <button onclick="proceedToBusSelection()" class="btn">Entendido, necesito el cupo</button>
             <button onclick="declineTransport()" class="btn btn-secondary">No necesito el cupo, gracias</button>
        </div>
      </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, onSnapshot, collection, getDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Configuración de Firebase - Actualiza estos valores con tu configuración real
        const firebaseConfig = {
            apiKey: "AIzaSyBbW9QZ7rZ8QZ7rZ8QZ7rZ8QZ7rZ8QZ7rZ",
            authDomain: "profe-francisco-blog.firebaseapp.com",
            projectId: "profe-francisco-blog",
            storageBucket: "profe-francisco-blog.appspot.com",
            messagingSenderId: "123456789012",
            appId: "1:123456789012:web:abcdef123456"
        };

        const appId = 'paseo-docentes-2025';

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        
        let userId = null;
        let selectedSeat = null;
        let userPreference = null;
        let personalData = {};

        const sections = {
            personalData: document.getElementById('step0-personal-data'),
            attendance: document.getElementById('step1-attendance'),
            transport: document.getElementById('step2-transport'),
            bus: document.getElementById('step3-bus-selection'),
            finalState: document.getElementById('final-state-container'),
        };

        const inputs = {
            fullName: document.getElementById('fullNameInput'),
            rut: document.getElementById('rutInput'),
            address: document.getElementById('addressInput'),
            emergencyPhone: document.getElementById('emergencyPhoneInput'),
            age: document.getElementById('ageInput'),
            gender: document.getElementById('genderInput')
        };

        const modals = {
            confirmModal: document.getElementById('confirmModal'),
            busBenefitModal: document.getElementById('busBenefitModal')
        }

        const busLayout = document.querySelector('.bus-layout');
        const passengerList = document.getElementById('passenger-list');
        const seatNumberModal = document.getElementById('seat-number-modal');
        const userNameDisplay = document.getElementById('userNameDisplay');
        
        const seatMap = [
             1,  2, null,  3,  4, 
             5,  6, null,  7,  8, 
             9, 10, null, 11, 12,
            13, 14, null, 15, 16, 
            17, 18, null, 19, 20, 
            21, 22, null, 23, 24,
            25, 26, null, 27, 28, 
            29, 30, null, 31, 32, 
            33, 34, null, 35, 36,
            37, 38, null, 39, 40, 
            41, 42, null, 43, 44, 
            45, 46, null, null, null
        ];

        function hideAllSteps() {
            Object.values(sections).forEach(sec => sec.classList.add('hidden'));
        }

        async function savePreference(preference) {
            if (!userId) return;
            const userDocRef = doc(db, `artifacts/${appId}/public/data/participantes`, userId);
            const dataToSave = { ...personalData, ...preference, timestamp: new Date() };
            await setDoc(userDocRef, dataToSave, { merge: true });
        }

        window.processPersonalData = () => {
            const data = {
                nombre: inputs.fullName.value.trim(),
                rut: inputs.rut.value.trim(),
                direccion: inputs.address.value.trim(),
                telefonoEmergencia: inputs.emergencyPhone.value.trim(),
                edad: inputs.age.value,
                genero: inputs.gender.value,
            };

            for (const key in data) {
                if (!data[key]) {
                    alert('Por favor, completa todos los campos de datos personales.');
                    return;
                }
            }
            personalData = data;
            hideAllSteps();
            userNameDisplay.textContent = data.nombre;
            sections.attendance.classList.remove('hidden');
        };

        window.handleAttendance = (attends) => {
            if (attends) {
                hideAllSteps();
                sections.transport.classList.remove('hidden');
            } else {
                savePreference({ asiste: false, necesitaTransporte: null, asiento: null });
            }
        };

        window.handleTransport = (needsTransport) => {
            if (needsTransport) {
                modals.busBenefitModal.classList.remove('hidden');
            } else {
                savePreference({ asiste: true, necesitaTransporte: false, asiento: null });
            }
        };
        
        window.declineTransport = () => {
            closeModal('busBenefitModal');
            savePreference({ asiste: true, necesitaTransporte: false, asiento: null });
        };

        window.proceedToBusSelection = () => {
            closeModal('busBenefitModal');
            hideAllSteps();
            sections.bus.classList.remove('hidden');
        }
        
        window.resetPreference = async () => {
             if (!userId) return;
             if(userPreference && userPreference.asiento){
                const seatDocRef = doc(db, `artifacts/${appId}/public/data/asientos-paseo`, String(userPreference.asiento));
                await deleteDoc(seatDocRef);
             }
             const userDocRef = doc(db, `artifacts/${appId}/public/data/participantes`, userId);
             await deleteDoc(userDocRef);
             userPreference = null;
             personalData = {};
             Object.values(inputs).forEach(input => {
                input.value = '';
                input.disabled = false;
             });
        }

        function renderUI() {
            hideAllSteps();
            if (!userPreference) {
                sections.personalData.classList.remove('hidden');
            } else {
                const { asiste, necesitaTransporte, asiento, ...savedPersonalData } = userPreference;
                personalData = savedPersonalData;
                Object.keys(inputs).forEach(key => {
                    const inputKeyMap = {
                        fullName: 'nombre', rut: 'rut', address: 'direccion',
                        emergencyPhone: 'telefonoEmergencia', age: 'edad', gender: 'genero'
                    };
                    const dataKey = inputKeyMap[key];
                     if(savedPersonalData[dataKey]) {
                         inputs[key].value = savedPersonalData[dataKey];
                         inputs[key].disabled = true;
                     }
                });

                let message = '';
                if (!asiste) {
                    message = 'Has confirmado que no asistirás. ¡Te echaremos de menos!';
                } else if (necesitaTransporte === false) {
                    message = '¡Gracias por confirmar! Has indicado que irás por tus propios medios. ¡Nos vemos allá!';
                } else if (necesitaTransporte === true && asiento) {
                    message = `Has reservado el asiento N°${asiento} en el bus. ¡Tu cupo está asegurado!`;
                    sections.bus.classList.remove('hidden');
                } else if (necesitaTransporte === true && !asiento) {
                    hideAllSteps();
                    sections.bus.classList.remove('hidden');
                    return;
                } else {
                     resetPreference();
                     return;
                }
                document.getElementById('final-state-message').textContent = message;
                sections.finalState.classList.remove('hidden');
            }
        }
        
        function createBusLayout(reservations) {
            if (!busLayout) return;
            busLayout.innerHTML = '';
            seatMap.forEach(seatNum => {
                const seatDiv = document.createElement('div');
                if (seatNum === null) {
                    seatDiv.className = 'seat aisle';
                } else {
                    const reservation = reservations.find(r => r.id === String(seatNum));
                    seatDiv.className = 'seat';
                    seatDiv.dataset.seat = seatNum;
                    seatDiv.textContent = seatNum;

                    if (reservation) {
                        seatDiv.classList.add('taken');
                        const tooltip = document.createElement('span');
                        tooltip.className = 'tooltip';
                        tooltip.textContent = reservation.nombre;
                        if(reservation.userId === userId){
                            seatDiv.classList.add('mine');
                            tooltip.textContent = "¡Este es tu asiento!"
                        }
                        seatDiv.appendChild(tooltip);
                    } else {
                        seatDiv.onclick = () => openModal('confirmModal', seatNum);
                    }
                }
                busLayout.appendChild(seatDiv);
            });
        }

        function updatePassengerList(reservations) {
            if (!passengerList) return;
            const sorted = [...reservations].sort((a, b) => parseInt(a.id) - parseInt(b.id));
            passengerList.innerHTML = sorted.length ? '' : '<p class="text-gray-500">Aún no hay pasajeros.</p>';
            sorted.forEach(res => {
                const p = document.createElement('p');
                p.className = 'text-sm mb-1';
                p.innerHTML = `<strong class="text-blue-600">Asiento ${res.id}:</strong> ${res.nombre}`;
                passengerList.appendChild(p);
            });
        }
        
        window.openModal = (modalName, seatNum) => {
            if (seatNum) {
                selectedSeat = seatNum;
                seatNumberModal.textContent = seatNum;
            }
            modals[modalName].classList.remove('hidden');
        };

        window.closeModal = (modalName) => {
            modals[modalName].classList.add('hidden');
            if (modalName === 'confirmModal') {
                selectedSeat = null;
            }
        };
        
        window.reserveSeat = async () => {
            if (selectedSeat) {
                await savePreference({ asiste: true, necesitaTransporte: true, asiento: selectedSeat });
                const seatDocRef = doc(db, `artifacts/${appId}/public/data/asientos-paseo`, String(selectedSeat));
                await setDoc(seatDocRef, { nombre: personalData.nombre, userId });
                closeModal('confirmModal');
            }
        };

        async function setupAuth() {
            try {
                await signInAnonymously(auth);
                userId = auth.currentUser.uid;
                console.log('Autenticación exitosa:', userId);
            } catch (error) {
                console.error("Error en la autenticación:", error);
                alert('Error al inicializar la aplicación. Por favor, recarga la página.');
            }
        }

        async function main() {
            await setupAuth();
            if (!userId) {
                console.error("Authentication failed. Cannot proceed.");
                return;
            }

            const userDocRef = doc(db, `artifacts/${appId}/public/data/participantes`, userId);
            onSnapshot(userDocRef, (docSnap) => {
                userPreference = docSnap.exists() ? docSnap.data() : null;
                renderUI();
            }, (error) => {
                console.error("Error listening to user preference:", error);
            });

            const seatsCollectionRef = collection(db, `artifacts/${appId}/public/data/asientos-paseo`);
            
            onSnapshot(seatsCollectionRef, (snapshot) => {
                const reservations = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                createBusLayout(reservations);
                updatePassengerList(reservations);
            }, (error) => {
                console.error("Error listening to seat reservations:", error);
            });
        }
        
        document.addEventListener('DOMContentLoaded', main);
    </script>
</body>
</html>