<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üóëÔ∏è Gesti√≥n de Bases de Datos por Docente</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body class="bg-gradient-to-br from-gray-100 to-gray-200 p-6">
    
    <div class="max-w-7xl mx-auto">
        
        <!-- HEADER -->
        <div class="bg-white rounded-xl shadow-2xl overflow-hidden mb-6">
            <div class="bg-gradient-to-r from-purple-600 to-indigo-600 p-6 text-white">
                <h1 class="text-3xl font-bold flex items-center">
                    <i class="fas fa-database mr-3"></i>
                    Gesti√≥n de Bases de Datos por Docente
                </h1>
                <p class="text-purple-100 mt-2">Sistema de limpieza y backup para bases de datos individuales</p>
            </div>

            <!-- ESTADO ACTUAL -->
            <div class="p-6 bg-gray-50">
                <h2 class="text-xl font-bold text-gray-800 mb-4">üìä Estado Actual de las Bases de Datos</h2>
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4" id="estadoDocentes">
                    <!-- Se llena din√°micamente -->
                </div>
            </div>
        </div>

        <!-- GRID DE DOCENTES -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
            
            <!-- FRANCISCO -->
            <div class="bg-white rounded-xl shadow-lg overflow-hidden border-2 border-indigo-400">
                <div class="bg-gradient-to-r from-indigo-500 to-indigo-600 p-4 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="text-xl font-bold">Francisco Javier</h3>
                            <p class="text-sm text-indigo-100">Namespace: francisco</p>
                        </div>
                        <i class="fas fa-user-tie text-3xl"></i>
                    </div>
                    <div class="mt-3 grid grid-cols-2 gap-2 text-center">
                        <div class="bg-indigo-700 rounded p-2">
                            <p class="text-xs">Cursos</p>
                            <p id="francisco-cursos" class="text-2xl font-bold">0</p>
                        </div>
                        <div class="bg-indigo-700 rounded p-2">
                            <p class="text-xs">Estudiantes</p>
                            <p id="francisco-estudiantes" class="text-2xl font-bold">0</p>
                        </div>
                    </div>
                </div>
                <div class="p-4 space-y-2">
                    <button onclick="verDetalles('francisco')" class="w-full bg-blue-500 hover:bg-blue-600 text-white py-2 px-4 rounded-lg">
                        <i class="fas fa-eye mr-2"></i>Ver Detalles
                    </button>
                    <button onclick="backupDocente('francisco')" class="w-full bg-green-500 hover:bg-green-600 text-white py-2 px-4 rounded-lg">
                        <i class="fas fa-download mr-2"></i>Backup
                    </button>
                    <button onclick="confirmarLimpieza('francisco')" class="w-full bg-red-500 hover:bg-red-600 text-white py-2 px-4 rounded-lg">
                        <i class="fas fa-trash-alt mr-2"></i>Limpiar
                    </button>
                </div>
            </div>

            <!-- JAVIERA -->
            <div class="bg-white rounded-xl shadow-lg overflow-hidden border-2 border-purple-400">
                <div class="bg-gradient-to-r from-purple-500 to-purple-600 p-4 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="text-xl font-bold">Javiera</h3>
                            <p class="text-sm text-purple-100">Namespace: javiera</p>
                        </div>
                        <i class="fas fa-user-graduate text-3xl"></i>
                    </div>
                    <div class="mt-3 grid grid-cols-2 gap-2 text-center">
                        <div class="bg-purple-700 rounded p-2">
                            <p class="text-xs">Cursos</p>
                            <p id="javiera-cursos" class="text-2xl font-bold">0</p>
                        </div>
                        <div class="bg-purple-700 rounded p-2">
                            <p class="text-xs">Estudiantes</p>
                            <p id="javiera-estudiantes" class="text-2xl font-bold">0</p>
                        </div>
                    </div>
                </div>
                <div class="p-4 space-y-2">
                    <button onclick="verDetalles('javiera')" class="w-full bg-blue-500 hover:bg-blue-600 text-white py-2 px-4 rounded-lg">
                        <i class="fas fa-eye mr-2"></i>Ver Detalles
                    </button>
                    <button onclick="backupDocente('javiera')" class="w-full bg-green-500 hover:bg-green-600 text-white py-2 px-4 rounded-lg">
                        <i class="fas fa-download mr-2"></i>Backup
                    </button>
                    <button onclick="confirmarLimpieza('javiera')" class="w-full bg-red-500 hover:bg-red-600 text-white py-2 px-4 rounded-lg">
                        <i class="fas fa-trash-alt mr-2"></i>Limpiar
                    </button>
                </div>
            </div>

            <!-- VALENTINA (DOCENTE 3) -->
            <div class="bg-white rounded-xl shadow-lg overflow-hidden border-2 border-teal-400">
                <div class="bg-gradient-to-r from-teal-500 to-teal-600 p-4 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="text-xl font-bold">Valentina</h3>
                            <p class="text-sm text-teal-100">Namespace: docente3</p>
                        </div>
                        <i class="fas fa-user text-3xl"></i>
                    </div>
                    <div class="mt-3 grid grid-cols-2 gap-2 text-center">
                        <div class="bg-teal-700 rounded p-2">
                            <p class="text-xs">Cursos</p>
                            <p id="docente3-cursos" class="text-2xl font-bold">0</p>
                        </div>
                        <div class="bg-teal-700 rounded p-2">
                            <p class="text-xs">Estudiantes</p>
                            <p id="docente3-estudiantes" class="text-2xl font-bold">0</p>
                        </div>
                    </div>
                </div>
                <div class="p-4 space-y-2">
                    <button onclick="verDetalles('docente3')" class="w-full bg-blue-500 hover:bg-blue-600 text-white py-2 px-4 rounded-lg">
                        <i class="fas fa-eye mr-2"></i>Ver Detalles
                    </button>
                    <button onclick="backupDocente('docente3')" class="w-full bg-green-500 hover:bg-green-600 text-white py-2 px-4 rounded-lg">
                        <i class="fas fa-download mr-2"></i>Backup
                    </button>
                    <button onclick="confirmarLimpieza('docente3')" class="w-full bg-red-500 hover:bg-red-600 text-white py-2 px-4 rounded-lg">
                        <i class="fas fa-trash-alt mr-2"></i>Limpiar
                    </button>
                </div>
            </div>

            <!-- MARCELO (DOCENTE 4) -->
            <div class="bg-white rounded-xl shadow-lg overflow-hidden border-2 border-orange-400">
                <div class="bg-gradient-to-r from-orange-500 to-orange-600 p-4 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="text-xl font-bold">Marcelo</h3>
                            <p class="text-sm text-orange-100">Namespace: docente4</p>
                        </div>
                        <i class="fas fa-user text-3xl"></i>
                    </div>
                    <div class="mt-3 grid grid-cols-2 gap-2 text-center">
                        <div class="bg-orange-700 rounded p-2">
                            <p class="text-xs">Cursos</p>
                            <p id="docente4-cursos" class="text-2xl font-bold">0</p>
                        </div>
                        <div class="bg-orange-700 rounded p-2">
                            <p class="text-xs">Estudiantes</p>
                            <p id="docente4-estudiantes" class="text-2xl font-bold">0</p>
                        </div>
                    </div>
                </div>
                <div class="p-4 space-y-2">
                    <button onclick="verDetalles('docente4')" class="w-full bg-blue-500 hover:bg-blue-600 text-white py-2 px-4 rounded-lg">
                        <i class="fas fa-eye mr-2"></i>Ver Detalles
                    </button>
                    <button onclick="backupDocente('docente4')" class="w-full bg-green-500 hover:bg-green-600 text-white py-2 px-4 rounded-lg">
                        <i class="fas fa-download mr-2"></i>Backup
                    </button>
                    <button onclick="confirmarLimpieza('docente4')" class="w-full bg-red-500 hover:bg-red-600 text-white py-2 px-4 rounded-lg">
                        <i class="fas fa-trash-alt mr-2"></i>Limpiar
                    </button>
                </div>
            </div>

        </div>

        <!-- ACCIONES MASIVAS -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
            <h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                <i class="fas fa-tools mr-2 text-orange-600"></i>
                Acciones Masivas
            </h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <button onclick="backupTodos()" class="bg-green-600 hover:bg-green-700 text-white py-3 px-6 rounded-lg font-semibold">
                    <i class="fas fa-cloud-download-alt mr-2"></i>Backup de TODOS
                </button>
                <button onclick="limpiarNoFrancisco()" class="bg-orange-600 hover:bg-orange-700 text-white py-3 px-6 rounded-lg font-semibold">
                    <i class="fas fa-broom mr-2"></i>Limpiar Javiera, Valentina, Marcelo
                </button>
                <button onclick="restaurarBackup()" class="bg-blue-600 hover:bg-blue-700 text-white py-3 px-6 rounded-lg font-semibold">
                    <i class="fas fa-upload mr-2"></i>Restaurar desde Backup
                </button>
            </div>
        </div>

        <!-- √ÅREA DE DETALLES -->
        <div id="areaDetalles" class="hidden bg-white rounded-xl shadow-lg p-6">
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-xl font-bold text-gray-800">
                    <i class="fas fa-list mr-2"></i>Detalles: <span id="detalleDocente"></span>
                </h2>
                <button onclick="cerrarDetalles()" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times text-2xl"></i>
                </button>
            </div>
            <div id="contenidoDetalles" class="space-y-4">
                <!-- Se llena din√°micamente -->
            </div>
        </div>

        <!-- LOG DE ACCIONES -->
        <div class="bg-gray-900 rounded-xl p-6 text-green-400 font-mono text-sm">
            <h3 class="text-xl font-bold mb-4 text-white flex items-center">
                <i class="fas fa-terminal mr-2"></i>Log de Acciones
            </h3>
            <div id="logAcciones" class="h-64 overflow-y-auto space-y-1">
                <p class="text-yellow-400">[SISTEMA] Gestor de bases de datos iniciado...</p>
            </div>
        </div>

    </div>

    <script>
        // Configuraci√≥n de docentes
        const DOCENTES_CONFIG = {
            francisco: { namespace: 'francisco', nombre: 'Francisco Javier N√∫√±ez', color: 'indigo' },
            javiera: { namespace: 'javiera', nombre: 'Javiera Poblete', color: 'purple' },
            docente3: { namespace: 'docente3', nombre: 'Valentina', color: 'teal' },
            docente4: { namespace: 'docente4', nombre: 'Marcelo', color: 'orange' }
        };

        // Log de acciones
        function log(mensaje, tipo = 'info') {
            const logDiv = document.getElementById('logAcciones');
            const timestamp = new Date().toLocaleTimeString();
            const colores = {
                info: 'text-blue-400',
                success: 'text-green-400',
                error: 'text-red-400',
                warning: 'text-yellow-400'
            };
            
            const p = document.createElement('p');
            p.className = colores[tipo];
            p.textContent = `[${timestamp}] ${mensaje}`;
            logDiv.appendChild(p);
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        // Obtener datos de un docente
        function getDatosDocente(namespace) {
            const key = `${namespace}_allCourses`;
            const data = localStorage.getItem(key);
            
            if (!data) return { cursos: 0, estudiantes: 0, cursosData: [] };
            
            try {
                const cursos = JSON.parse(data);
                const totalEstudiantes = cursos.reduce((sum, curso) => 
                    sum + (curso.students?.length || 0), 0
                );
                
                return {
                    cursos: cursos.length,
                    estudiantes: totalEstudiantes,
                    cursosData: cursos
                };
            } catch (e) {
                log(`Error parseando datos de ${namespace}: ${e.message}`, 'error');
                return { cursos: 0, estudiantes: 0, cursosData: [] };
            }
        }

        // Actualizar estado de todos los docentes
        function actualizarEstado() {
            Object.keys(DOCENTES_CONFIG).forEach(key => {
                const docente = DOCENTES_CONFIG[key];
                const datos = getDatosDocente(docente.namespace);
                
                document.getElementById(`${key}-cursos`).textContent = datos.cursos;
                document.getElementById(`${key}-estudiantes`).textContent = datos.estudiantes;
            });
            
            log('Estado actualizado', 'info');
        }

        // Ver detalles de un docente
        function verDetalles(namespace) {
            const docente = DOCENTES_CONFIG[namespace];
            const datos = getDatosDocente(docente.namespace);
            
            document.getElementById('detalleDocente').textContent = docente.nombre;
            const contenido = document.getElementById('contenidoDetalles');
            
            if (datos.cursos === 0) {
                contenido.innerHTML = '<p class="text-gray-600">No hay cursos registrados.</p>';
            } else {
                let html = '<div class="space-y-3">';
                datos.cursosData.forEach((curso, i) => {
                    html += `
                        <div class="bg-gray-50 border-2 border-gray-300 rounded-lg p-4">
                            <h4 class="font-bold text-gray-800">${i + 1}. ${curso.courseName || 'Sin nombre'}</h4>
                            <div class="grid grid-cols-3 gap-2 mt-2 text-sm">
                                <div>
                                    <p class="text-gray-600">Estudiantes:</p>
                                    <p class="font-semibold">${curso.students?.length || 0}</p>
                                </div>
                                <div>
                                    <p class="text-gray-600">Tareas:</p>
                                    <p class="font-semibold">${curso.tasks?.length || 0}</p>
                                </div>
                                <div>
                                    <p class="text-gray-600">ID:</p>
                                    <p class="font-semibold text-xs">${curso.id}</p>
                                </div>
                            </div>
                        </div>
                    `;
                });
                html += '</div>';
                contenido.innerHTML = html;
            }
            
            document.getElementById('areaDetalles').classList.remove('hidden');
            log(`Detalles mostrados: ${docente.nombre}`, 'info');
        }

        function cerrarDetalles() {
            document.getElementById('areaDetalles').classList.add('hidden');
        }

        // Backup de un docente
        function backupDocente(namespace) {
            const docente = DOCENTES_CONFIG[namespace];
            const datos = getDatosDocente(docente.namespace);
            
            const backup = {
                docente: docente.nombre,
                namespace: docente.namespace,
                fecha: new Date().toISOString(),
                cursos: datos.cursosData,
                totalCursos: datos.cursos,
                totalEstudiantes: datos.estudiantes
            };
            
            const blob = new Blob([JSON.stringify(backup, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `backup_${namespace}_${Date.now()}.json`;
            a.click();
            
            log(`‚úÖ Backup creado: ${docente.nombre} (${datos.cursos} cursos)`, 'success');
        }

        // Limpiar datos de un docente
        function limpiarDocente(namespace) {
            const docente = DOCENTES_CONFIG[namespace];
            const key = `${namespace}_allCourses`;
            
            localStorage.removeItem(key);
            localStorage.removeItem(`${namespace}_currentCourseId`);
            
            log(`üóëÔ∏è Base de datos limpiada: ${docente.nombre}`, 'warning');
            actualizarEstado();
        }

        // Confirmar limpieza
        function confirmarLimpieza(namespace) {
            const docente = DOCENTES_CONFIG[namespace];
            const datos = getDatosDocente(docente.namespace);
            
            if (datos.cursos === 0) {
                alert(`${docente.nombre} no tiene cursos para eliminar.`);
                return;
            }
            
            const mensaje = `‚ö†Ô∏è ADVERTENCIA ‚ö†Ô∏è\n\n` +
                `¬øEliminar TODOS los datos de ${docente.nombre}?\n\n` +
                `- ${datos.cursos} cursos\n` +
                `- ${datos.estudiantes} estudiantes\n` +
                `- Todas las tareas y notas\n\n` +
                `Esta acci√≥n NO se puede deshacer.\n\n` +
                `Se recomienda hacer un BACKUP primero.`;
            
            if (confirm(mensaje)) {
                if (confirm(`¬øEst√°s ABSOLUTAMENTE seguro de eliminar los datos de ${docente.nombre}?`)) {
                    backupDocente(namespace); // Backup autom√°tico antes de borrar
                    limpiarDocente(namespace);
                    alert(`‚úÖ Datos de ${docente.nombre} eliminados.\n\nBackup creado autom√°ticamente.`);
                }
            }
        }

        // Backup de todos
        function backupTodos() {
            log('üì¶ Creando backup completo de todos los docentes...', 'warning');
            
            Object.keys(DOCENTES_CONFIG).forEach(key => {
                backupDocente(key);
            });
            
            log('‚úÖ Backup completo finalizado', 'success');
            alert('‚úÖ Backup de TODOS los docentes creado exitosamente.');
        }

        // Limpiar todos excepto Francisco
        function limpiarNoFrancisco() {
            const mensaje = `‚ö†Ô∏è ACCI√ìN MASIVA ‚ö†Ô∏è\n\n` +
                `¬øEliminar datos de:\n` +
                `- Javiera\n` +
                `- Valentina\n` +
                `- Marcelo\n\n` +
                `Francisco NO ser√° afectado.\n\n` +
                `Se crear√° un backup autom√°tico de cada uno.\n\n` +
                `¬øContinuar?`;
            
            if (confirm(mensaje)) {
                log('üöÄ Iniciando limpieza masiva...', 'warning');
                
                // Backup primero
                backupDocente('javiera');
                backupDocente('docente3');
                backupDocente('docente4');
                
                // Luego limpiar
                limpiarDocente('javiera');
                limpiarDocente('docente3');
                limpiarDocente('docente4');
                
                log('‚úÖ Limpieza masiva completada', 'success');
                alert('‚úÖ Javiera, Valentina y Marcelo han sido limpiados.\n\nBackups creados autom√°ticamente.\n\nFrancisco NO fue afectado.');
            }
        }

        // Restaurar desde backup
        function restaurarBackup() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            
            input.onchange = async (e) => {
                const file = e.target.files[0];
                if (!file) return;
                
                try {
                    const text = await file.text();
                    const backup = JSON.parse(text);
                    
                    if (!backup.namespace || !backup.cursos) {
                        throw new Error('Archivo de backup inv√°lido');
                    }
                    
                    const key = `${backup.namespace}_allCourses`;
                    localStorage.setItem(key, JSON.stringify(backup.cursos));
                    
                    log(`‚úÖ Backup restaurado: ${backup.docente}`, 'success');
                    actualizarEstado();
                    alert(`‚úÖ Backup restaurado exitosamente para ${backup.docente}`);
                } catch (error) {
                    log(`‚ùå Error restaurando backup: ${error.message}`, 'error');
                    alert(`Error al restaurar backup:\n${error.message}`);
                }
            };
            
            input.click();
        }

        // Inicializar
        actualizarEstado();
        setInterval(actualizarEstado, 10000); // Actualizar cada 10 segundos

        log('Sistema listo para operar', 'success');
    </script>

</body>
</html>
