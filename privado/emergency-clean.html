<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>üö® LIMPIEZA DE EMERGENCIA</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-red-50 p-8">
    <div class="max-w-4xl mx-auto bg-white p-8 rounded-lg shadow-2xl">
        <h1 class="text-3xl font-bold text-red-600 mb-6">üö® LIMPIEZA DE EMERGENCIA</h1>
        
        <div class="space-y-4">
            <button onclick="cleanEverything()" 
                    class="w-full bg-red-600 text-white px-8 py-4 rounded-lg text-xl font-bold hover:bg-red-700">
                üî• LIMPIAR TODO AHORA
            </button>
            
            <div id="result" class="mt-6"></div>
        </div>
    </div>

    <script>
        async function cleanEverything() {
            const result = document.getElementById('result');
            result.innerHTML = '<p class="text-xl font-bold">Limpiando...</p>';
            
            let log = '<div class="space-y-2 text-sm">';
            
            // 1. Limpiar localStorage COMPLETAMENTE
            log += '<p class="font-bold text-lg mt-4">üì¶ LocalStorage:</p>';
            const allKeys = Object.keys(localStorage);
            const courseKeys = allKeys.filter(k => 
                k.includes('Courses') || 
                k.includes('course') || 
                k.includes('francisco') || 
                k.includes('profesor2') ||
                k.includes('needsSync') ||
                k.includes('totalWipe')
            );
            
            courseKeys.forEach(key => {
                localStorage.removeItem(key);
                log += `<p>‚ùå ${key}</p>`;
            });
            
            // 2. Limpiar BD con TODOS los posibles usernames
            log += '<p class="font-bold text-lg mt-4">üóÑÔ∏è Base de Datos:</p>';
            
            const allUsernames = [
                'fconuva',
                'francisco_fconuva',
                'profesor2_profesor2',
                'fconuva_francisco',
                'fconuva_profesor2'
            ];
            
            for (const username of allUsernames) {
                try {
                    const response = await fetch('/api/courses/save', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            courses: [],
                            username: username
                        })
                    });
                    
                    const data = await response.json();
                    if (data.success) {
                        log += `<p class="text-green-600">‚úÖ ${username}</p>`;
                    } else {
                        log += `<p class="text-yellow-600">‚ö†Ô∏è ${username}: ${data.error}</p>`;
                    }
                } catch (e) {
                    log += `<p class="text-red-600">‚ùå ${username}: ${e.message}</p>`;
                }
                
                await new Promise(r => setTimeout(r, 300));
            }
            
            log += '</div>';
            
            log += `
                <div class="bg-green-100 border-2 border-green-500 p-6 rounded-lg mt-6">
                    <p class="text-2xl font-bold text-green-800 mb-4">‚úÖ LIMPIEZA COMPLETADA</p>
                    <p class="text-green-700 mb-4">Ahora ambos docentes empezar√°n completamente desde cero.</p>
                    <div class="space-y-2">
                        <a href="registro-notas.html?docente=francisco" 
                           class="block bg-indigo-600 text-white text-center px-6 py-3 rounded-lg hover:bg-indigo-700 font-semibold">
                            üë§ Abrir como Francisco
                        </a>
                        <a href="setup-profesor2.html" 
                           class="block bg-purple-600 text-white text-center px-6 py-3 rounded-lg hover:bg-purple-700 font-semibold">
                            üë• Configurar Profesor 2
                        </a>
                    </div>
                </div>
            `;
            
            result.innerHTML = log;
        }
    </script>
</body>
</html>
