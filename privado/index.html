<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#4F46E5">
    <title>Acceso Privado</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* Tailwind CSS Reset & Base */
        *,::before,::after{box-sizing:border-box;border-width:0;border-style:solid;border-color:#e5e7eb}
        html{line-height:1.5;-webkit-text-size-adjust:100%;tab-size:4;font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji"}
        body{margin:0;line-height:inherit}
        h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}
        a{color:inherit;text-decoration:inherit}
        button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;font-weight:inherit;line-height:inherit;color:inherit;margin:0;padding:0}
        button,select{text-transform:none}
        button,[type='button'],[type='submit']{-webkit-appearance:button;background-color:transparent;background-image:none}
        img,svg,video,canvas,audio,iframe,embed,object{display:block;vertical-align:middle}
        img,video{max-width:100%;height:auto}
        /* Tailwind Utilities */
        .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border-width:0}
        .relative{position:relative}
        .flex{display:flex}
        .hidden{display:none}
        .min-h-screen{min-height:100vh}
        .w-full{width:100%}
        .max-w-md{max-width:28rem}
        .items-center{align-items:center}
        .justify-center{justify-content:center}
        .space-y-6>:not([hidden])~:not([hidden]){margin-top:1.5rem}
        .rounded-xl{border-radius:0.75rem}
        .rounded-lg{border-radius:0.5rem}
        .rounded-full{border-radius:9999px}
        .border{border-width:1px}
        .border-gray-300{border-color:#d1d5db}
        .border-green-300{border-color:#86efac}
        .border-red-300{border-color:#fca5a5}
        .bg-white{background-color:#fff}
        .bg-indigo-600{background-color:#4f46e5}
        .bg-green-100{background-color:#dcfce7}
        .bg-red-100{background-color:#fee2e2}
        .p-4{padding:1rem}
        .p-8{padding:2rem}
        .py-3{padding-top:0.75rem;padding-bottom:0.75rem}
        .px-4{padding-left:1rem;padding-right:1rem}
        .px-10{padding-left:2.5rem;padding-right:2.5rem}
        .pl-10{padding-left:2.5rem}
        .pr-10{padding-right:2.5rem}
        .mt-2{margin-top:0.5rem}
        .text-3xl{font-size:1.875rem;line-height:2.25rem}
        .text-sm{font-size:0.875rem;line-height:1.25rem}
        .text-lg{font-size:1.125rem;line-height:1.75rem}
        .text-center{text-align:center}
        .text-left{text-align:left}
        .font-bold{font-weight:700}
        .font-medium{font-medium:500}
        .text-gray-700{color:#374151}
        .text-gray-800{color:#1f2937}
        .text-gray-600{color:#4b5563}
        .text-white{color:#fff}
        .text-green-800{color:#166534}
        .text-red-800{color:#991b1b}
        .shadow-lg{box-shadow:0 10px 15px -3px rgb(0 0 0/0.1),0 4px 6px -4px rgb(0 0 0/0.1)}
        .hover\:bg-indigo-700:hover{background-color:#4338ca}
        .focus\:outline-none:focus{outline:2px solid transparent;outline-offset:2px}
        .focus\:ring-2:focus{box-shadow:0 0 0 2px #fff,0 0 0 4px #4f46e5}
        .focus\:ring-indigo-500:focus{--tw-ring-color:#6366f1}
        .focus\:border-indigo-500:focus{border-color:#6366f1}
        .opacity-75{opacity:0.75}
        .cursor-not-allowed{cursor:not-allowed}
        .whitespace-pre-line{white-space:pre-line}
        .block{display:block}
        .transition{transition-property:color,background-color,border-color,text-decoration-color,fill,stroke,opacity,box-shadow,transform,filter,backdrop-filter;transition-timing-function:cubic-bezier(0.4,0,0.2,1);transition-duration:150ms}
        .duration-300{transition-duration:300ms}
        .animate-spin{animation:spin 1s linear infinite}
        @keyframes spin{to{transform:rotate(360deg)}}
    </style>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-overflow-scrolling: touch;
            min-height: 100vh;
        }
        
        .login-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .login-header {
            background: linear-gradient(135deg, #4F46E5 0%, #7C3AED 100%);
        }
        
        * {
            -webkit-tap-highlight-color: rgba(79, 70, 229, 0.2);
        }
        
        button, a, input {
            -webkit-tap-highlight-color: rgba(79, 70, 229, 0.3);
        }
        
        /* Prevenir zoom en inputs (iOS) */
        input {
            font-size: 16px !important;
        }
        
        button {
            min-height: 44px;
        }
        
        .floating-shapes {
            position: fixed;
            width: 100%;
            height: 100%;
            overflow: hidden;
            z-index: -1;
        }
        
        .shape {
            position: absolute;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            animation: float 15s infinite;
        }
        
        .shape:nth-child(1) { width: 80px; height: 80px; top: 10%; left: 10%; animation-delay: 0s; }
        .shape:nth-child(2) { width: 60px; height: 60px; top: 20%; right: 15%; animation-delay: 2s; }
        .shape:nth-child(3) { width: 100px; height: 100px; bottom: 15%; left: 20%; animation-delay: 4s; }
        .shape:nth-child(4) { width: 50px; height: 50px; bottom: 25%; right: 25%; animation-delay: 6s; }
        .shape:nth-child(5) { width: 70px; height: 70px; top: 50%; left: 5%; animation-delay: 8s; }
        
        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(0deg); opacity: 0.5; }
            50% { transform: translateY(-20px) rotate(180deg); opacity: 0.8; }
        }
        
        .input-modern {
            background: #f8fafc;
            border: 2px solid #e2e8f0;
            transition: all 0.3s ease;
        }
        
        .input-modern:focus {
            background: white;
            border-color: #4F46E5;
            box-shadow: 0 0 0 4px rgba(79, 70, 229, 0.1);
        }
        
        .btn-gradient {
            background: linear-gradient(135deg, #4F46E5 0%, #7C3AED 100%);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .btn-gradient:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(79, 70, 229, 0.3);
        }
        
        .btn-gradient:active {
            transform: translateY(0);
        }
        
        /* Optimizaciones m√≥vil */
        @media (max-width: 768px) {
            body {
                padding: 1rem;
            }
            
            .max-w-md {
                max-width: 100% !important;
            }
            
            h1 {
                font-size: 1.5rem !important;
            }
            
            input {
                padding: 0.75rem 2.5rem !important;
            }
        }
        
        /* iOS safe area */
        @supports (-webkit-touch-callout: none) {
            body {
                padding-top: env(safe-area-inset-top);
                padding-bottom: env(safe-area-inset-bottom);
            }
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen">

    <!-- Formas flotantes decorativas -->
    <div class="floating-shapes">
        <div class="shape"></div>
        <div class="shape"></div>
        <div class="shape"></div>
        <div class="shape"></div>
        <div class="shape"></div>
    </div>

    <div class="w-full max-w-md login-card rounded-2xl shadow-2xl overflow-hidden">
        <!-- Header con gradiente -->
        <div class="login-header text-white px-8 py-8 text-center">
            <div class="w-20 h-20 bg-white bg-opacity-20 rounded-full mx-auto mb-4 flex items-center justify-center">
                <i class="fas fa-graduation-cap text-4xl"></i>
            </div>
            <h1 class="text-2xl font-bold">Herramienta Docente</h1>
            <p class="mt-2 text-sm opacity-90">Sistema de Registro y Evaluaci√≥n</p>
        </div>

        <div class="p-8">
            <form id="login-form" class="space-y-5">
                <div>
                    <label for="username" class="block text-sm font-medium text-gray-700 mb-2">
                        <i class="fas fa-user mr-2 text-indigo-500"></i>Usuario
                    </label>
                    <div class="relative">
                        <input id="username" name="username" type="text" required autocomplete="username"
                            class="w-full px-4 py-3 rounded-xl input-modern focus:outline-none"
                            placeholder="Ingresa tu usuario">
                    </div>
                </div>

                <div>
                    <label for="password" class="block text-sm font-medium text-gray-700 mb-2">
                        <i class="fas fa-lock mr-2 text-indigo-500"></i>Contrase√±a
                    </label>
                    <div class="relative">
                        <input id="password" name="password" type="password" required autocomplete="current-password"
                            class="w-full px-4 py-3 pr-12 rounded-xl input-modern focus:outline-none"
                            placeholder="Ingresa tu contrase√±a">
                        <button type="button" id="toggle-password" class="absolute inset-y-0 right-0 flex items-center px-4 text-gray-400 hover:text-indigo-600 transition-colors">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                </div>

                <div id="login-message" class="hidden p-4 rounded-xl text-sm font-medium"></div>

                <div class="pt-2">
                    <button id="login-btn" type="submit"
                        class="w-full flex justify-center py-3.5 px-4 rounded-xl shadow-lg text-sm font-semibold text-white btn-gradient focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                        <span id="btn-text"><i class="fas fa-sign-in-alt mr-2"></i>Ingresar</span>
                        <span id="btn-loading" class="hidden">
                            <i class="fas fa-spinner fa-spin mr-2"></i>Verificando...
                        </span>
                    </button>
                </div>
            </form>
            
            <div class="mt-6 text-center text-xs text-gray-500">
                <p>¬© 2025 Sistema de Gesti√≥n Docente</p>
            </div>
        </div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        const loginForm = document.getElementById('login-form');
        const usernameInput = document.getElementById('username');
        const passwordInput = document.getElementById('password');
        const togglePasswordBtn = document.getElementById('toggle-password');
        const loginBtn = document.getElementById('login-btn');
        const btnText = document.getElementById('btn-text');
        const btnLoading = document.getElementById('btn-loading');
        const loginMessage = document.getElementById('login-message');

        // Redirect if already logged in
        if (sessionStorage.getItem('isLoggedIn') === 'true') {
            window.location.href = 'dashboard.html';
        }

        togglePasswordBtn.addEventListener('click', function() {
            const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
            passwordInput.setAttribute('type', type);
            this.querySelector('i').className = `fas fa-eye${type === 'password' ? '' : '-slash'}`;
        });

        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCzN4xNEE_hKshXbsVqLhWSnzet1pHwRh8",
            authDomain: "profe-blog.firebaseapp.com",
            databaseURL: "https://profe-blog-default-rtdb.firebaseio.com",
            projectId: "profe-blog",
            storageBucket: "profe-blog.firebasestorage.app",
            messagingSenderId: "305920739217",
            appId: "1:305920739217:web:2e08c7469d2988d8b3bc30"
        };

        // Initialize Firebase
        if (!firebase.apps || !firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const database = firebase.database();

        // Metadata de usuarios (roles y nombres) - NO INCLUYE CONTRASE√ëAS
        const USER_METADATA = {
            'fconuva@gmail.com': {
                role: 'admin',
                fullName: 'Francisco (Administrador)',
                username: 'fconuva'
            },
            'alicia@profe.cl': {
                role: 'teacher',
                fullName: 'Alicia (Profesora)',
                username: 'alicia'
            },
            'joselin@profe.cl': {
                role: 'teacher',
                fullName: 'Joselin (Profesora)',
                username: 'joselin'
            },
            'pia@profe.cl': {
                role: 'teacher',
                fullName: 'Pia (Profesora)',
                username: 'pia'
            },
            'invitado@profe.cl': {
                role: 'guest',
                fullName: 'Invitado (Visitante)',
                username: 'invitado'
            },
            'cristofer@profe.cl': {
                role: 'teacher',
                fullName: 'Cristofer Hernandez (Ingl√©s)',
                username: 'cristofer'
            },
            'nicolas@profe.cl': {
                role: 'teacher',
                fullName: 'Nicolas Ulloa (Biolog√≠a)',
                username: 'nicolas'
            },
            'reinaldo@profe.cl': {
                role: 'teacher',
                fullName: 'Reinaldo Camilla (Matem√°tica)',
                username: 'reinaldo'
            }
        };

        loginForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            setLoadingState(true);

            const username = usernameInput.value.trim().toLowerCase();
            const password = passwordInput.value;

            // Convertir username a email para Firebase Auth
            let email;
            if (username.includes('@')) {
                email = username;
            } else if (username === 'fconuva') {
                email = 'fconuva@gmail.com';
            } else {
                email = `${username}@profe.cl`;
            }

            try {
                // Intentar login con Firebase Auth
                const userCredential = await firebase.auth().signInWithEmailAndPassword(email, password);
                const user = userCredential.user;
                
                // Obtener metadata del usuario
                const metadata = USER_METADATA[email];
                
                if (metadata) {
                    showMessage(`¬°Bienvenida ${metadata.fullName}! Redirigiendo...`, 'success');
                    
                    // Guardar sesi√≥n
                    sessionStorage.setItem('isLoggedIn', 'true');
                    sessionStorage.setItem('username', metadata.username);
                    sessionStorage.setItem('userRole', metadata.role);
                    sessionStorage.setItem('userFullName', metadata.fullName);
                    sessionStorage.setItem('userEmail', email);
                    
                    // Redirecci√≥n inmediata para mejor UX
                    window.location.href = '/privado/dashboard.html';
                } else {
                    showMessage('Usuario no autorizado.', 'error');
                    await firebase.auth().signOut();
                    setLoadingState(false);
                }
            } catch (error) {
                console.error('Error de autenticaci√≥n:', error);
                
                if (error.code === 'auth/configuration-not-found') {
                    showMessage('‚ö†Ô∏è Firebase Auth no configurado correctamente. Pasos:\n\n' +
                               '1. Firebase Console ‚Üí Authentication ‚Üí Sign-in method\n' +
                               '2. Habilitar "Email/Password"\n' +
                               '3. Agregar dominios autorizados en Settings\n' +
                               '4. Verificar que la API Key no tenga restricciones que bloqueen el dominio\n\n' +
                               'Contacta al administrador.', 'error');
                } else if (error.code === 'auth/user-not-found' || error.code === 'auth/wrong-password' || error.code === 'auth/invalid-login-credentials' || error.code === 'auth/invalid-credential') {
                    showMessage('‚ùå Usuario o contrase√±a incorrectos.\n\n' +
                               'üí° Si eres administrador y es la primera vez:\n' +
                               '1. Ve a Firebase Console ‚Üí Authentication ‚Üí Users\n' +
                               '2. Click "Add User"\n' +
                               '3. Email: ' + (username.includes('@') ? username : username + '@profe.cl') + '\n' +
                               '4. Contrase√±a: [tu contrase√±a]\n' +
                               '5. Intenta nuevamente', 'error');
                } else if (error.code === 'auth/too-many-requests') {
                    showMessage('üö´ Demasiados intentos fallidos. Intenta m√°s tarde.', 'error');
                } else if (error.code === 'auth/network-request-failed') {
                    showMessage('üåê Error de conexi√≥n. Verifica tu internet.', 'error');
                } else {
                    showMessage(`‚ùå Error de autenticaci√≥n: ${error.code || error.message}\n\nSi el error persiste, contacta al administrador.`, 'error');
                }
                
                setLoadingState(false);
            }
        });

        function showMessage(message, type) {
            // Preservar saltos de l√≠nea en el mensaje
            loginMessage.innerHTML = message.replace(/\n/g, '<br>');
            loginMessage.className = 'p-4 rounded-lg text-sm font-medium block whitespace-pre-line text-left ';
            if (type === 'success') {
                loginMessage.classList.add('bg-green-100', 'text-green-800', 'border', 'border-green-300');
            } else {
                loginMessage.classList.add('bg-red-100', 'text-red-800', 'border', 'border-red-300');
            }
        }

        function setLoadingState(loading) {
            if (loading) {
                btnText.classList.add('hidden');
                btnLoading.classList.remove('hidden');
                loginBtn.disabled = true;
                loginBtn.classList.add('opacity-75', 'cursor-not-allowed');
            } else {
                btnText.classList.remove('hidden');
                btnLoading.classList.add('hidden');
                loginBtn.disabled = false;
                loginBtn.classList.remove('opacity-75', 'cursor-not-allowed');
            }
        }
    });
    </script>

</body>
</html>
