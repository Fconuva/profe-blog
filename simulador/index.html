<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulador Sueldo 2025 CEST</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=Roboto+Slab:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'inter': ['Inter', 'sans-serif'],
                        'roboto-slab': ['Roboto Slab', 'serif']
                    }
                }
            }
        }
    </script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Premium Navigation Styles */
        .header-enhanced {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(249, 250, 251, 0.95) 100%);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(229, 231, 235, 0.8);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        }

        .professional-name {
            font-family: 'Roboto Slab', serif;
            font-weight: 700;
            background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-size: 1.125rem;
        }

        .nav-link {
            font-family: 'Inter', sans-serif;
            font-weight: 500;
            color: #374151;
            transition: all 0.3s ease;
            position: relative;
        }

        .nav-link:hover {
            color: #1f2937;
            transform: translateY(-1px);
        }

        .btn-premium {
            background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
            color: white;
            font-family: 'Inter', sans-serif;
            font-weight: 600;
            padding: 0.75rem 1.5rem;
            border-radius: 0.75rem;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
        }

        .btn-premium:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.4);
        }

        .interactive-hover {
            transition: all 0.3s ease;
        }

        .interactive-hover:hover {
            transform: scale(1.05);
        }

        .interactive-text {
            transition: color 0.3s ease;
        }

        .interactive-text:hover {
            color: #3b82f6 !important;
        }

        /* Mobile menu styles */
        #mobile-menu {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(20px);
            border-top: 1px solid rgba(229, 231, 235, 0.8);
        }

        /* Dark mode support */
        @media (prefers-color-scheme: dark) {
            .header-enhanced {
                background: linear-gradient(135deg, rgba(17, 24, 39, 0.95) 0%, rgba(31, 41, 55, 0.95) 100%);
                border-bottom: 1px solid rgba(75, 85, 99, 0.8);
            }

            .nav-link {
                color: #e5e7eb;
            }

            .nav-link:hover {
                color: #f9fafb;
            }

            #mobile-menu {
                background: rgba(17, 24, 39, 0.98);
                border-top: 1px solid rgba(75, 85, 99, 0.8);
            }
        }

        /* Modern Calculator Styles */
        :root {
            --bg-primary: #f8fafc;
            --bg-secondary: #ffffff;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --accent-primary: #3b82f6;
            --accent-secondary: #8b5cf6;
            --border-color: #e2e8f0;
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            --radius-sm: 0.375rem;
            --radius-md: 0.5rem;
            --radius-lg: 0.75rem;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            margin: 0;
            padding: 0;
        }

        .hero-section {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0.05) 100%);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: var(--radius-lg);
            padding: 3rem;
            margin: 2rem auto;
            max-width: 1200px;
            box-shadow: var(--shadow-lg);
        }

        .hero-title {
            font-family: 'Roboto Slab', serif;
            font-size: 2.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, #ffffff 0%, #e2e8f0 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-align: center;
            margin-bottom: 1rem;
        }

        .hero-subtitle {
            font-size: 1.125rem;
            color: rgba(255, 255, 255, 0.9);
            text-align: center;
            margin-bottom: 2rem;
        }

        .calculator-container {
            background: var(--bg-secondary);
            border-radius: var(--radius-lg);
            padding: 2.5rem;
            box-shadow: var(--shadow-lg);
            margin: 2rem auto;
            max-width: 1200px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .section-title {
            font-family: 'Roboto Slab', serif;
            font-size: 1.875rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .section-title::before {
            content: '';
            width: 4px;
            height: 24px;
            background: linear-gradient(135deg, var(--accent-primary) 0%, var(--accent-secondary) 100%);
            border-radius: 2px;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-label {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
            font-size: 0.875rem;
        }

        .form-input, .form-select {
            padding: 0.875rem 1rem;
            border: 2px solid var(--border-color);
            border-radius: var(--radius-md);
            font-size: 1rem;
            transition: all 0.3s ease;
            background: var(--bg-secondary);
            color: var(--text-primary);
        }

        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 1rem;
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.05) 0%, rgba(139, 92, 246, 0.05) 100%);
            border: 1px solid rgba(59, 130, 246, 0.1);
            border-radius: var(--radius-md);
            transition: all 0.3s ease;
        }

        .checkbox-group:hover {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.08) 0%, rgba(139, 92, 246, 0.08) 100%);
            border-color: rgba(59, 130, 246, 0.2);
        }

        .checkbox-input {
            width: 1.25rem;
            height: 1.25rem;
            accent-color: var(--accent-primary);
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--accent-primary) 0%, var(--accent-secondary) 100%);
            color: white;
            padding: 1rem 2rem;
            border-radius: var(--radius-md);
            font-weight: 600;
            font-size: 1rem;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: var(--shadow-md);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .btn-secondary {
            background: #6b7280;
            color: white;
            padding: 1rem 2rem;
            border-radius: var(--radius-md);
            font-weight: 600;
            font-size: 1rem;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-secondary:hover {
            background: #4b5563;
            transform: translateY(-2px);
        }

        .btn-add {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: var(--radius-md);
            font-weight: 600;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 1rem;
        }

        .btn-add:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .btn-remove {
            background: #ef4444;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: var(--radius-sm);
            font-size: 0.875rem;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-remove:hover {
            background: #dc2626;
        }

        .results-container {
            display: none;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-top: 3rem;
            padding: 2rem;
            background: var(--bg-secondary);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-lg);
        }

        .results-column {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.05) 0%, rgba(139, 92, 246, 0.05) 100%);
            padding: 1.5rem;
            border-radius: var(--radius-md);
            border: 1px solid rgba(59, 130, 246, 0.1);
        }

        .results-title {
            font-family: 'Roboto Slab', serif;
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .results-title::before {
            content: '';
            width: 3px;
            height: 20px;
            background: linear-gradient(135deg, var(--accent-primary) 0%, var(--accent-secondary) 100%);
            border-radius: 2px;
        }

        .result-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 0;
            border-bottom: 1px solid var(--border-color);
        }

        .result-item:last-child {
            border-bottom: none;
        }

        .result-label {
            font-weight: 500;
            color: var(--text-primary);
        }

        .result-value {
            font-weight: 700;
            color: var(--accent-primary);
        }

        .result-total {
            background: linear-gradient(135deg, var(--accent-primary) 0%, var(--accent-secondary) 100%);
            color: white;
            padding: 1rem;
            border-radius: var(--radius-md);
            text-align: center;
            font-size: 1.125rem;
            font-weight: 700;
            margin-top: 1rem;
        }

        .final-result {
            grid-column: 1 / -1;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            padding: 2rem;
            border-radius: var(--radius-lg);
            text-align: center;
            font-size: 1.5rem;
            font-weight: 700;
            box-shadow: var(--shadow-lg);
        }

        .theme-selector {
            position: fixed;
            top: 100px;
            right: 2rem;
            z-index: 1000;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            padding: 1rem;
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-md);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .theme-selector select {
            padding: 0.5rem;
            border-radius: var(--radius-sm);
            border: 1px solid var(--border-color);
            background: white;
            font-size: 0.875rem;
        }

        /* Dark Theme */
        body.dark-theme {
            --bg-primary: #0f172a;
            --bg-secondary: #1e293b;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --border-color: #334155;
        }

        body.dark-theme .hero-section {
            background: linear-gradient(135deg, rgba(30, 41, 59, 0.8) 0%, rgba(51, 65, 85, 0.6) 100%);
            border-color: rgba(255, 255, 255, 0.1);
        }

        body.dark-theme .calculator-container {
            background: var(--bg-secondary);
            border-color: rgba(255, 255, 255, 0.1);
        }

        /* Cyberpunk Theme */
        body.cyberpunk-theme {
            --bg-primary: #0d0221;
            --bg-secondary: rgba(26, 2, 64, 0.8);
            --text-primary: #00f0ff;
            --text-secondary: #b794f6;
            --accent-primary: #ff00ff;
            --accent-secondary: #f9f871;
            --border-color: #ff00ff;
        }

        body.cyberpunk-theme .calculator-container,
        body.cyberpunk-theme .results-container {
            border: 1px solid var(--accent-primary);
            box-shadow: 0 0 20px rgba(255, 0, 255, 0.3);
        }

        /* Teacher Theme */
        body.teacher-theme {
            --bg-primary: #fce4ec;
            --bg-secondary: #ffffff;
            --text-primary: #880e4f;
            --text-secondary: #be185d;
            --accent-primary: #ec407a;
            --accent-secondary: #ab47bc;
            --border-color: #f8bbd0;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .hero-section {
                padding: 2rem 1.5rem;
                margin: 1rem;
            }

            .calculator-container {
                padding: 2rem 1.5rem;
                margin: 1rem;
            }

            .hero-title {
                font-size: 2rem;
            }

            .results-container {
                grid-template-columns: 1fr;
                gap: 1rem;
            }

            .form-grid {
                grid-template-columns: 1fr;
            }

            .theme-selector {
                position: static;
                margin: 1rem auto;
                max-width: 200px;
            }
        }

        /* Animations */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .animate-fade-in-up {
            animation: fadeInUp 0.6s ease-out;
        }

        /* Loading Animation */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <!-- Navigation Bar -->
    <header class="header-enhanced sticky top-0 z-50" role="banner">
        <nav class="container mx-auto px-6 py-4 flex justify-between items-center" role="navigation" aria-label="Main navigation">
            <a href="/" class="flex items-center space-x-3" aria-label="Inicio">
                <img src="/imagenes/logo-profe-francisco-nuevo.svg" alt="Logo Profe Francisco - Átomo del Conocimiento" class="h-12 w-auto interactive-hover rounded-lg"/>
                <span class="text-lg font-extrabold professional-name interactive-text">Francisco Javier Núñez</span>
            </a>

            <div class="hidden md:flex items-center space-x-6">
                <a href="/#sobre-mi" class="nav-link interactive-hover interactive-text relative group">
                    Sobre Mí
                    <span class="absolute -bottom-1 left-0 w-0 h-0.5 bg-gradient-to-r from-blue-500 to-purple-500 transition-all duration-300 group-hover:w-full"></span>
                </a>
                <a href="/#servicios" class="nav-link interactive-hover interactive-text relative group">
                    Servicios
                    <span class="absolute -bottom-1 left-0 w-0 h-0.5 bg-gradient-to-r from-blue-500 to-purple-500 transition-all duration-300 group-hover:w-full"></span>
                </a>
                <a href="/#apps" class="nav-link interactive-hover interactive-text relative group">
                    Herramientas
                    <span class="absolute -bottom-1 left-0 w-0 h-0.5 bg-gradient-to-r from-blue-500 to-purple-500 transition-all duration-300 group-hover:w-full"></span>
                </a>
                <a href="/tips-carrera-docente/" class="nav-link interactive-hover interactive-text relative group">
                    Tips Docentes
                    <span class="absolute -bottom-1 left-0 w-0 h-0.5 bg-gradient-to-r from-blue-500 to-purple-500 transition-all duration-300 group-hover:w-full"></span>
                </a>
                <a href="/portafolio/" class="nav-link interactive-hover interactive-text relative group">
                    Portafolio
                    <span class="absolute -bottom-1 left-0 w-0 h-0.5 bg-gradient-to-r from-blue-500 to-purple-500 transition-all duration-300 group-hover:w-full"></span>
                </a>
                <a href="/simulador/" class="nav-link interactive-hover interactive-text relative group text-blue-600 font-semibold">
                    Simulador
                    <span class="absolute -bottom-1 left-0 w-full h-0.5 bg-gradient-to-r from-blue-500 to-purple-500"></span>
                </a>
                <a href="/contacto/" class="btn-premium">Contacto</a>
            </div>

            <div class="md:hidden">
                <button id="mobile-menu-button" class="text-gray-800 dark:text-gray-200 focus:outline-none p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors" aria-expanded="false" aria-controls="mobile-menu">
                    <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"/>
                    </svg>
                </button>
            </div>
        </nav>

        <div id="mobile-menu" class="md:hidden hidden bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700 shadow-lg" role="menu">
            <a href="/#sobre-mi" class="block py-3 px-6 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors" role="menuitem">Sobre Mí</a>
            <a href="/#servicios" class="block py-3 px-6 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors" role="menuitem">Servicios</a>
            <a href="/#apps" class="block py-3 px-6 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors" role="menuitem">Herramientas</a>
            <a href="/tips-carrera-docente/" class="block py-3 px-6 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors" role="menuitem">Tips Docentes</a>
            <a href="/portafolio/" class="block py-3 px-6 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors" role="menuitem">Portafolio</a>
            <a href="/simulador/" class="block py-3 px-6 text-blue-600 dark:text-blue-400 font-medium hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors" role="menuitem">Simulador</a>
            <a href="/contacto/" class="block py-3 px-6 text-blue-600 dark:text-blue-400 font-medium hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors" role="menuitem">Contacto</a>
        </div>
    </header>

    <!-- Hero Section -->
    <section class="hero-section animate-fade-in-up">
        <h1 class="hero-title">
            <i class="fas fa-calculator mr-4"></i>
            Simulador de Sueldo 2025
        </h1>
        <p class="hero-subtitle">
            Calcula tu remuneración docente con precisión. Incluye todos los beneficios, descuentos y asignaciones del año 2025.
        </p>
    </section>

    <!-- Theme Selector -->
    <div class="theme-selector">
        <label for="theme-selector" class="block text-sm font-medium text-white mb-2">Tema Visual</label>
        <select id="theme-selector" onchange="changeTheme()" class="w-full">
            <option value="light">🌞 Claro</option>
            <option value="dark">🌙 Oscuro</option>
            <option value="cyberpunk">⚡ Cyberpunk</option>
            <option value="teacher">🎓 Teacher</option>
        </select>
    </div>

    <!-- Calculator Container -->
    <div class="calculator-container animate-fade-in-up">
        <!-- Role Selection -->
        <div class="mb-8">
            <h2 class="section-title">
                <i class="fas fa-user-graduate"></i>
                Selecciona tu Rol Profesional
            </h2>
            <div class="form-grid">
                <div class="form-group">
                    <label for="tipoProfesional" class="form-label">Tipo de Profesional</label>
                    <select id="tipoProfesional" onchange="updateFormForRole()" class="form-select">
                        <option value="docente">Docente (Básica/Media)</option>
                        <option value="parvulos">Educadora de Párvulos</option>
                        <option value="asistente">Asistente de la Educación</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Docente Parameters -->
        <div id="params-docente">
            <h2 class="section-title">
                <i class="fas fa-chalkboard-teacher"></i>
                Parámetros del Docente/Educadora
            </h2>
            <div class="form-grid">
                <div class="form-group" id="horasDocenteContainer">
                    <label for="horasMedia" class="form-label">Horas Educación Media</label>
                    <input type="number" id="horasMedia" placeholder="Ej: 22" class="form-input">
                </div>
                <div class="form-group" id="horasDocenteContainer2">
                    <label for="horasBasica" class="form-label">Horas Educación Básica</label>
                    <input type="number" id="horasBasica" placeholder="Ej: 22" class="form-input">
                </div>
                <div class="form-group" id="horasParvulosContainer" style="display: none;">
                    <label for="horasContratoParvulos" class="form-label">Horas de Contrato</label>
                    <input type="number" id="horasContratoParvulos" placeholder="Ej: 44" class="form-input">
                </div>
                <div class="form-group">
                    <label for="mes" class="form-label">Mes de Cálculo</label>
                    <select id="mes" class="form-select">
                        <option value="0">Enero</option><option value="1">Febrero</option><option value="2">Marzo</option>
                        <option value="3">Abril</option><option value="4">Mayo</option><option value="5" selected>Junio</option>
                        <option value="6">Julio</option><option value="7">Agosto</option><option value="8">Septiembre</option>
                        <option value="9">Octubre</option><option value="10">Noviembre</option><option value="11">Diciembre</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="tramo" class="form-label">Tramo Desarrollo Profesional</label>
                    <select id="tramo" class="form-select">
                        <option value="" disabled selected>Seleccionar...</option>
                        <option value="acceso">Acceso</option><option value="inicial">Inicial</option>
                        <option value="temprano">Temprano</option><option value="avanzado">Avanzado</option>
                        <option value="expertoI">Experto I</option><option value="expertoII">Experto II</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="bieniosDocente" class="form-label">Número de Bienios</label>
                    <input type="number" id="bieniosDocente" placeholder="Ej: 5" class="form-input">
                </div>
                <div class="form-group">
                    <label for="diasTrabajadosDocente" class="form-label">Días Trabajados en el Mes</label>
                    <input type="number" id="diasTrabajadosDocente" placeholder="Ej: 30" class="form-input">
                </div>
            </div>

            <h3 class="section-title" style="font-size: 1.25rem; margin-top: 2rem;">
                <i class="fas fa-award"></i>
                Bonos y Asignaciones
            </h3>
            <div class="form-grid">
                <div class="checkbox-group" id="brpMencionContainer">
                    <input type="checkbox" id="tieneMencion" class="checkbox-input">
                    <label for="tieneMencion" class="form-label" style="margin-bottom: 0;">BRP por Mención</label>
                </div>
                <div class="checkbox-group">
                    <input type="checkbox" id="bonoBEA" class="checkbox-input">
                    <label for="bonoBEA" class="form-label" style="margin-bottom: 0;">Bono Excelencia (SNED)</label>
                </div>
                <div class="checkbox-group">
                    <input type="checkbox" id="bonoProfesorJefe" class="checkbox-input">
                    <label for="bonoProfesorJefe" class="form-label" style="margin-bottom: 0;">Bono Profesor Jefe</label>
                </div>
                <div class="form-group">
                    <label for="asigBieniosContrato" class="form-label">Asignación Bienios (Contrato Colectivo)</label>
                    <input type="number" id="asigBieniosContrato" placeholder="Ej: 44842" class="form-input">
                </div>
            </div>
        </div>

        <!-- Asistente Parameters -->
        <div id="params-asistente" style="display: none;">
            <h2 class="section-title">
                <i class="fas fa-user-friends"></i>
                Parámetros del Asistente de la Educación
            </h2>
            <div class="form-grid">
                <div class="form-group">
                    <label for="sueldoBaseAsistente" class="form-label">Sueldo Base Mensual</label>
                    <input type="number" id="sueldoBaseAsistente" placeholder="Ej: 500000" class="form-input">
                </div>
                <div class="form-group">
                    <label for="bieniosAsistente" class="form-label">Número de Bienios (2% c/u)</label>
                    <input type="number" id="bieniosAsistente" placeholder="Ej: 3" class="form-input">
                </div>
                <div class="form-group">
                    <label for="diasTrabajadosAsistente" class="form-label">Días Trabajados en el Mes</label>
                    <input type="number" id="diasTrabajadosAsistente" placeholder="Ej: 30" class="form-input">
                </div>
            </div>
            <h3 class="section-title" style="font-size: 1.25rem; margin-top: 2rem;">
                <i class="fas fa-gift"></i>
                Bonos
            </h3>
            <div class="form-grid">
                <div class="checkbox-group">
                    <input type="checkbox" id="bonoSemestralAsistente" class="checkbox-input">
                    <label for="bonoSemestralAsistente" class="form-label" style="margin-bottom: 0;">Bono Semestral (Abril/Octubre)</label>
                </div>
            </div>
        </div>

        <!-- Additional Income -->
        <div class="mb-8">
            <h2 class="section-title">
                <i class="fas fa-plus-circle"></i>
                Otros Ingresos Adicionales
            </h2>
            <div id="otros-ingresos-container"></div>
            <button type="button" class="btn-add" onclick="addOtroIngreso()">
                <i class="fas fa-plus mr-2"></i>
                Agregar Otro Ingreso
            </button>
        </div>

        <!-- Discounts and Provisions -->
        <div class="mb-8">
            <h2 class="section-title">
                <i class="fas fa-calculator"></i>
                Descuentos y Previsión
            </h2>
            <div class="form-grid">
                <div class="form-group">
                    <label for="afp" class="form-label">Sistema de AFP</label>
                    <select id="afp" class="form-select">
                        <option value="" disabled selected>Seleccionar...</option>
                        <option value="cuprum">CUPRUM (1.44%)</option>
                        <option value="capital">Capital (1.44%)</option>
                        <option value="habitat">Habitat (1.27%)</option>
                        <option value="modelo">Modelo (0.58%)</option>
                        <option value="planvital">PlanVital (1.16%)</option>
                        <option value="provida">Provida (1.45%)</option>
                        <option value="uno">Uno (0.49%)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="sistemaSalud" class="form-label">Sistema de Salud</label>
                    <select id="sistemaSalud" onchange="toggleIsapreField()" class="form-select">
                        <option value="fonasa">FONASA</option>
                        <option value="isapre">ISAPRE</option>
                    </select>
                </div>
                <div class="form-group" id="isapreField" style="display: none;">
                    <label for="costoSaludUF" class="form-label">Costo Plan ISAPRE (UF)</label>
                    <input type="number" id="costoSaludUF" placeholder="Ej: 3.558" step="0.001" class="form-input">
                </div>
            </div>

            <h3 class="section-title" style="font-size: 1.25rem; margin-top: 2rem;">
                <i class="fas fa-minus-circle"></i>
                Otros Descuentos (APV, Créditos, etc.)
            </h3>
            <div id="otros-descuentos-container"></div>
            <button type="button" class="btn-add" onclick="addOtroDescuento()">
                <i class="fas fa-plus mr-2"></i>
                Agregar Otro Descuento
            </button>
        </div>

        <!-- Action Buttons -->
        <div class="flex flex-wrap gap-4 justify-center">
            <button id="btn-calculate" onclick="calculateSalary()" class="btn-primary">
                <i class="fas fa-calculator mr-2"></i>
                Calcular Sueldo
            </button>
            <button id="btn-clear" onclick="clearForm()" class="btn-secondary">
                <i class="fas fa-trash mr-2"></i>
                Borrar Todo
            </button>
            <button id="btn-pdf" onclick="downloadPDF()" class="btn-primary">
                <i class="fas fa-download mr-2"></i>
                Descargar PDF
            </button>
        </div>
    </div>

    <!-- Results Container -->
    <div id="results-container" class="calculator-container">
        <!-- Results will be populated by JavaScript -->
    </div>

    <!-- Footer -->
    <footer class="text-center py-8 text-white/80">
        <p>&copy; 2025 Francisco Javier Núñez Valenzuela. Todos los derechos reservados.</p>
    </footer>

    <script>
        // --- LÓGICA DE LA CALCULADORA ---
        const datosAnuales2025 = [
            { mes: "Enero", valorUF: 38416, utm: 64666 }, { mes: "Febrero", valorUF: 38384, utm: 64793 },
            { mes: "Marzo", valorUF: 38647, utm: 65182 }, { mes: "Abril", valorUF: 38894, utm: 65443 },
            { mes: "Mayo", valorUF: 39189, utm: 65770 }, { mes: "Junio", valorUF: 39267, utm: 66100 },
            { mes: "Julio", valorUF: 39450, utm: 66450 }, { mes: "Agosto", valorUF: 39600, utm: 66800 },
            { mes: "Septiembre", valorUF: 39750, utm: 67150 }, { mes: "Octubre", valorUF: 39900, utm: 67500 },
            { mes: "Noviembre", valorUF: 40050, utm: 67850 }, { mes: "Diciembre", valorUF: 40200, utm: 68200 }
        ];

        const parametrosDocente2025 = {
            valorHoraMedia: 20208, valorHoraBasica: 19329,
            brpTitulo: 337461,
            brpMencion: 112490,
            asignacionTramo: { acceso: 19884, inicial: 75752, temprano: 114227, avanzado: 321247, expertoI: 494360, expertoII: 1062338 },
            valorPorBienio: 20379,
            asigPrioritariosTramos: {
                avanzado: { tramo1: 63386, tramo2: 127778, tramo3: 130471 },
                expertoI: { tramo1: 130471, tramo2: 181455, tramo3: 275431 },
                expertoII: { tramo1: 130471, tramo2: 181455, tramo3: 275431 }
            }
        };

        const parametrosParvulos2025 = {
            valorHora: 19329,
            brpTitulo: 339621,
            brpMencion: 0,
            asignacionTramo: { acceso: 19884, inicial: 75752, temprano: 325635, avanzado: 334097, expertoI: 494360, expertoII: 1062338 },
            valorPorBienio: 215635 / 10,
            asigPrioritariosTramos: {
                temprano: { tramo1: 63386, tramo2: 129063, tramo3: 130471 },
                avanzado: { tramo1: 63386, tramo2: 129063, tramo3: 130471 },
                expertoI: { tramo1: 130471, tramo2: 181455, tramo3: 275431 },
                expertoII: { tramo1: 130471, tramo2: 181455, tramo3: 275431 }
            }
        };

        const parametrosComunes = {
            bonoBEA: 162262,
            bonoProfJefe: 70000,
            bonoAsistente: 60000,
            valorDiaColacion: 3200,
            valorDiaMovilizacion: 3000,
        };

        const tasasAFP = {
            cuprum: 0.0144, capital: 0.0144, habitat: 0.0127,
            modelo: 0.0058, planvital: 0.0116, provida: 0.0145, uno: 0.0049
        };

        function formatCurrency(value) {
            return '$' + Math.round(value).toLocaleString('es-CL');
        }

        function calculateSalary() {
            // Show loading state
            const btn = document.getElementById('btn-calculate');
            const originalText = btn.innerHTML;
            btn.innerHTML = '<div class="loading mr-2"></div>Calculando...';
            btn.disabled = true;

            setTimeout(() => {
                // 1. OBTENER VALORES DE LA INTERFAZ
                const rol = document.getElementById('tipoProfesional').value;
                const mesIndex = parseInt(document.getElementById('mes').value);
                const datosMes = datosAnuales2025[mesIndex];

                let totalImponible = 0, totalNoImponible = 0;
                let haberesImponiblesHTML = '', haberesNoImponiblesHTML = '';

                if (rol === 'docente' || rol === 'parvulos') {
                    let totalHoras, sueldoBase, parametros;
                    if (rol === 'docente') {
                        const horasMedia = parseFloat(document.getElementById('horasMedia').value) || 0;
                        const horasBasica = parseFloat(document.getElementById('horasBasica').value) || 0;
                        totalHoras = horasMedia + horasBasica;
                        parametros = parametrosDocente2025;
                        sueldoBase = (horasMedia * parametros.valorHoraMedia) + (horasBasica * parametros.valorHoraBasica);
                    } else { // Párvulos
                        totalHoras = parseFloat(document.getElementById('horasContratoParvulos').value) || 0;
                        parametros = parametrosParvulos2025;
                        sueldoBase = totalHoras * parametros.valorHora;
                    }

                    const tramo = document.getElementById('tramo').value;
                    const nBienios = parseInt(document.getElementById('bieniosDocente').value) || 0;
                    const diasTrabajados = parseInt(document.getElementById('diasTrabajadosDocente').value) || 0;
                    const porcPrioritarios = 67;
                    const asigBieniosContrato = parseFloat(document.getElementById('asigBieniosContrato').value) || 0;
                    const tieneMencion = (rol === 'docente') ? document.getElementById('tieneMencion').checked : false;
                    const tieneBonoBEA = document.getElementById('bonoBEA').checked;
                    const tieneBonoJefe = document.getElementById('bonoProfesorJefe').checked;

                    const proporcionHoras = totalHoras > 0 ? totalHoras / 44 : 0;
                    const brpTitulo = parametros.brpTitulo * proporcionHoras;
                    const brpMencion = tieneMencion ? (parametros.brpMencion * proporcionHoras) : 0;
                    const asignacionTramo = tramo ? parametros.asignacionTramo[tramo] * proporcionHoras : 0;

                    let asignacionPrioritarios = 0;
                    const tramosConBonoPrio = rol === 'docente' ? ['avanzado', 'expertoI', 'expertoII'] : ['temprano', 'avanzado', 'expertoI', 'expertoII'];
                    if (tramosConBonoPrio.includes(tramo)) {
                        const bonosPrioTramo = parametros.asigPrioritariosTramos[tramo];
                        if (bonosPrioTramo) {
                            if (porcPrioritarios >= 80) asignacionPrioritarios = bonosPrioTramo.tramo3 * proporcionHoras;
                            else if (porcPrioritarios >= 60) asignacionPrioritarios = bonosPrioTramo.tramo2 * proporcionHoras;
                            else if (porcPrioritarios >= 45) asignacionPrioritarios = bonosPrioTramo.tramo1 * proporcionHoras;
                        }
                    }

                    const mesesSNED = [2, 5, 8, 11];
                    const v_bonoBEA = (tieneBonoBEA && mesesSNED.includes(mesIndex)) ? parametrosComunes.bonoBEA : 0;
                    const v_bonoJefe = tieneBonoJefe ? parametrosComunes.bonoProfJefe : 0;

                    totalImponible += sueldoBase + brpTitulo + brpMencion + asignacionTramo + asigBieniosContrato + asignacionPrioritarios + v_bonoBEA + v_bonoJefe;

                    haberesImponiblesHTML += `<div class="result-item"><span class="result-label">Sueldo Base (RBMN)</span> <span class="result-value">${formatCurrency(sueldoBase)}</span></div>`;
                    haberesImponiblesHTML += `<div class="result-item"><span class="result-label">BRP por Título</span> <span class="result-value">${formatCurrency(brpTitulo)}</span></div>`;
                    if (tieneMencion) haberesImponiblesHTML += `<div class="result-item"><span class="result-label">BRP por Mención</span> <span class="result-value">${formatCurrency(brpMencion)}</span></div>`;
                    haberesImponiblesHTML += `<div class="result-item"><span class="result-label">Asig. Tramo Profesional</span> <span class="result-value">${formatCurrency(asignacionTramo)}</span></div>`;
                    haberesImponiblesHTML += `<div class="result-item"><span class="result-label">Asignación Bienios (Contrato Colectivo)</span> <span class="result-value">${formatCurrency(asigBieniosContrato)}</span></div>`;
                    haberesImponiblesHTML += `<div class="result-item"><span class="result-label">Asig. Alumnos Prioritarios</span> <span class="result-value">${formatCurrency(asignacionPrioritarios)}</span></div>`;
                    if (v_bonoBEA > 0) haberesImponiblesHTML += `<div class="result-item"><span class="result-label">Bono Excelencia (SNED)</span> <span class="result-value">${formatCurrency(v_bonoBEA)}</span></div>`;
                    if (v_bonoJefe > 0) haberesImponiblesHTML += `<div class="result-item"><span class="result-label">Bono Profesor Jefe</span> <span class="result-value">${formatCurrency(v_bonoJefe)}</span></div>`;

                    let totalColacion = parametrosComunes.valorDiaColacion * diasTrabajados;
                    let totalMovilizacion = parametrosComunes.valorDiaMovilizacion * diasTrabajados;
                    if (mesIndex === 5 || mesIndex === 6) { totalColacion /= 2; totalMovilizacion /= 2; }
                    else if (mesIndex === 8) { totalColacion *= 0.75; totalMovilizacion *= 0.75; }
                    totalNoImponible += totalColacion + totalMovilizacion;
                    haberesNoImponiblesHTML += `<div class="result-item"><span class="result-label">Asig. Colación</span> <span class="result-value">${formatCurrency(totalColacion)}</span></div>`;
                    haberesNoImponiblesHTML += `<div class="result-item"><span class="result-label">Asig. Movilización</span> <span class="result-value">${formatCurrency(totalMovilizacion)}</span></div>`;

                } else { // Asistente de la Educación
                    const sueldoBaseAsistente = parseFloat(document.getElementById('sueldoBaseAsistente').value) || 0;
                    const nBieniosAsistente = parseInt(document.getElementById('bieniosAsistente').value) || 0;
                    const diasTrabajados = parseInt(document.getElementById('diasTrabajadosAsistente').value) || 0;
                    const tieneBonoSemestral = document.getElementById('bonoSemestralAsistente').checked;

                    const asigAntiguedad = sueldoBaseAsistente * 0.02 * nBieniosAsistente;
                    const mesesBonoAsistente = [3, 9]; // Abril y Octubre
                    const v_bonoAsistente = (tieneBonoSemestral && mesesBonoAsistente.includes(mesIndex)) ? parametrosComunes.bonoAsistente : 0;

                    totalImponible += sueldoBaseAsistente + asigAntiguedad + v_bonoAsistente;
                    haberesImponiblesHTML += `<div class="result-item"><span class="result-label">Sueldo Base</span> <span class="result-value">${formatCurrency(sueldoBaseAsistente)}</span></div>`;
                    haberesImponiblesHTML += `<div class="result-item"><span class="result-label">Asignación Antigüedad (${nBieniosAsistente} bienios)</span> <span class="result-value">${formatCurrency(asigAntiguedad)}</span></div>`;
                    if (v_bonoAsistente > 0) haberesImponiblesHTML += `<div class="result-item"><span class="result-label">Bono Semestral Asistente</span> <span class="result-value">${formatCurrency(v_bonoAsistente)}</span></div>`;

                    let totalColacion = parametrosComunes.valorDiaColacion * diasTrabajados;
                    let totalMovilizacion = parametrosComunes.valorDiaMovilizacion * diasTrabajados;
                    if (mesIndex === 5 || mesIndex === 6) { totalColacion /= 2; totalMovilizacion /= 2; }
                    else if (mesIndex === 8) { totalColacion *= 0.75; totalMovilizacion *= 0.75; }
                    totalNoImponible += totalColacion + totalMovilizacion;
                    haberesNoImponiblesHTML += `<div class="result-item"><span class="result-label">Asig. Colación</span> <span class="result-value">${formatCurrency(totalColacion)}</span></div>`;
                    haberesNoImponiblesHTML += `<div class="result-item"><span class="result-label">Asig. Movilización</span> <span class="result-value">${formatCurrency(totalMovilizacion)}</span></div>`;
                }

                // Procesar otros ingresos dinámicos
                let otrosImponiblesHTML = '';
                let otrosNoImponiblesHTML = '';
                document.querySelectorAll('#otros-ingresos-container .otro-ingreso-row').forEach(row => {
                    const desc = row.querySelector('.otro-ingreso-desc').value || 'Otro Ingreso';
                    const monto = parseFloat(row.querySelector('.otro-ingreso-monto').value) || 0;
                    const tipo = row.querySelector('.otro-ingreso-tipo').value;
                    if (monto > 0) {
                        if (tipo === 'imponible') {
                            totalImponible += monto;
                            otrosImponiblesHTML += `<div class="result-item"><span class="result-label">${desc}</span> <span class="result-value">${formatCurrency(monto)}</span></div>`;
                        } else {
                            totalNoImponible += monto;
                            otrosNoImponiblesHTML += `<div class="result-item"><span class="result-label">${desc}</span> <span class="result-value">${formatCurrency(monto)}</span></div>`;
                        }
                    }
                });
                haberesImponiblesHTML += otrosImponiblesHTML;
                haberesNoImponiblesHTML += otrosNoImponiblesHTML;

                // CALCULAR DESCUENTOS
                const afpKey = document.getElementById('afp').value;
                const sistemaSalud = document.getElementById('sistemaSalud').value;
                const costoSaludUF = (sistemaSalud === 'isapre') ? (parseFloat(document.getElementById('costoSaludUF').value) || 0) : 0;
                const valorUF = datosMes.valorUF;
                const utm = datosMes.utm;
                const topeImponiblePesos = 84.7 * valorUF;
                const baseCalculoDescuentos = Math.min(totalImponible, topeImponiblePesos);
                const descAfp = afpKey ? baseCalculoDescuentos * (0.10 + tasasAFP[afpKey]) : 0;
                const descSalud = baseCalculoDescuentos * 0.07;
                const descSeguroCesantia = baseCalculoDescuentos * 0.006;
                const baseTributable = totalImponible - (descAfp + descSalud + descSeguroCesantia);

                let impuestoUnico = 0;
                if (baseTributable > 13.5 * utm) {
                    let factor = 0, rebaja = 0;
                    if (baseTributable <= 30 * utm) { factor = 0.04; rebaja = 0.54 * utm; }
                    else if (baseTributable <= 50 * utm) { factor = 0.08; rebaja = 1.74 * utm; }
                    else if (baseTributable <= 70 * utm) { factor = 0.135; rebaja = 4.49 * utm; }
                    else if (baseTributable <= 90 * utm) { factor = 0.23; rebaja = 11.14 * utm; }
                    else if (baseTributable <= 120 * utm) { factor = 0.304; rebaja = 17.8 * utm; }
                    else if (baseTributable <= 310 * utm) { factor = 0.35; rebaja = 23.32 * utm; }
                    else { factor = 0.40; rebaja = 38.82 * utm; }
                    impuestoUnico = Math.max(0, (baseTributable * factor) - rebaja);
                }

                const cuotaSindicato = 5000;
                const cuotaBienestar = 4000;
                const costoPlanSaludPesos = costoSaludUF * valorUF;
                const adicionalSalud = Math.max(0, costoPlanSaludPesos - descSalud);

                let totalOtrosDescuentos = 0;
                document.querySelectorAll('#otros-descuentos-container .otro-descuento-row').forEach(row => {
                    totalOtrosDescuentos += parseFloat(row.querySelector('.otro-descuento-monto').value) || 0;
                });

                const totalDescuentos = descAfp + descSalud + descSeguroCesantia + impuestoUnico + adicionalSalud + cuotaSindicato + cuotaBienestar + totalOtrosDescuentos;

                // CÁLCULO FINAL
                const totalHaberes = totalImponible + totalNoImponible;
                const sueldoLiquido = totalHaberes - totalDescuentos;

                // MOSTRAR RESULTADOS
                let resultsHTML = `
                    <div class="results-column">
                        <h3 class="results-title">
                            <i class="fas fa-plus-circle"></i>
                            HABERES
                        </h3>
                        <h4 style="color: var(--text-secondary); font-size: 1rem; margin-bottom: 1rem; font-weight: 600;">Haberes Imponibles</h4>
                        ${haberesImponiblesHTML}
                        <div class="result-item result-total">
                            <span class="result-label">TOTAL IMPONIBLE</span>
                            <span class="result-value">${formatCurrency(totalImponible)}</span>
                        </div>

                        <h4 style="color: var(--text-secondary); font-size: 1rem; margin: 1.5rem 0 1rem 0; font-weight: 600;">Haberes No Imponibles</h4>
                        ${haberesNoImponiblesHTML}
                        <div class="result-item result-total">
                            <span class="result-label">TOTAL NO IMPONIBLE</span>
                            <span class="result-value">${formatCurrency(totalNoImponible)}</span>
                        </div>
                    </div>
                    <div class="results-column">
                        <h3 class="results-title">
                            <i class="fas fa-minus-circle"></i>
                            DESCUENTOS
                        </h3>
                        <div class="result-item"><span class="result-label">Cotización AFP</span> <span class="result-value">${formatCurrency(descAfp)}</span></div>
                        <div class="result-item"><span class="result-label">Cotización Salud (7%)</span> <span class="result-value">${formatCurrency(descSalud)}</span></div>
                        <div class="result-item"><span class="result-label">Seguro de Cesantía (0.6%)</span> <span class="result-value">${formatCurrency(descSeguroCesantia)}</span></div>
                        <div class="result-item"><span class="result-label">Adicional de Salud</span> <span class="result-value">${formatCurrency(adicionalSalud)}</span></div>
                        <div class="result-item"><span class="result-label">Impuesto Único</span> <span class="result-value">${formatCurrency(impuestoUnico)}</span></div>
                        <div class="result-item"><span class="result-label">Cuota Sindicato</span> <span class="result-value">${formatCurrency(cuotaSindicato)}</span></div>
                        <div class="result-item"><span class="result-label">Cuota Bienestar</span> <span class="result-value">${formatCurrency(cuotaBienestar)}</span></div>
                        ${generateOtrosHTML(document.querySelectorAll('#otros-descuentos-container .otro-descuento-row'))}
                        <div class="result-item result-total">
                            <span class="result-label">TOTAL DESCUENTOS</span>
                            <span class="result-value">${formatCurrency(totalDescuentos)}</span>
                        </div>
                    </div>
                    <div class="final-result">
                        <i class="fas fa-money-bill-wave mr-3"></i>
                        <strong>SUELDO LÍQUIDO A PAGAR:</strong>
                        <span style="font-size: 2rem; margin-left: 1rem;">${formatCurrency(sueldoLiquido)}</span>
                    </div>
                `;
                document.getElementById('results-container').innerHTML = resultsHTML;
                document.getElementById('results-container').style.display = 'grid';

                // Reset button
                btn.innerHTML = originalText;
                btn.disabled = false;
            }, 1000); // Simulate processing time
        }

        function generateOtrosHTML(rows, tipo = null) {
            let html = '';
            rows.forEach(row => {
                const desc = row.querySelector('input[type="text"]').value || 'Otro';
                const monto = parseFloat(row.querySelector('input[type="number"]').value) || 0;
                if (monto > 0) {
                    const tipoIngreso = row.querySelector('select') ? row.querySelector('select').value : null;
                    if (tipo === null || tipoIngreso === tipo) {
                        html += `<div class="result-item"><span class="result-label">${desc}</span> <span class="result-value">${formatCurrency(monto)}</span></div>`;
                    }
                }
            });
            return html;
        }

        function clearForm() {
            document.getElementById('calculator').reset();
            document.getElementById('otros-ingresos-container').innerHTML = '';
            document.getElementById('otros-descuentos-container').innerHTML = '';
            document.getElementById('results-container').style.display = 'none';
            document.getElementById('tramo').selectedIndex = 0;
            document.getElementById('afp').selectedIndex = 0;
            toggleIsapreField();
            updateFormForRole();
        }

        function changeTheme() {
            const theme = document.getElementById('theme-selector').value;
            document.body.className = theme + '-theme';
        }

        function addOtroIngreso() {
            const container = document.getElementById('otros-ingresos-container');
            const newRow = document.createElement('div');
            newRow.className = 'form-grid otro-ingreso-row';
            newRow.style.alignItems = 'end';
            newRow.innerHTML = `
                <div class="form-group">
                    <label class="form-label">Descripción</label>
                    <input type="text" class="otro-ingreso-desc form-input" placeholder="Ej: Aguinaldo">
                </div>
                <div class="form-group">
                    <label class="form-label">Monto</label>
                    <input type="number" class="otro-ingreso-monto form-input" placeholder="0">
                </div>
                <div class="form-group">
                    <label class="form-label">Tipo</label>
                    <select class="otro-ingreso-tipo form-select">
                        <option value="no_imponible">No Imponible</option>
                        <option value="imponible">Imponible</option>
                    </select>
                </div>
                <div class="form-group">
                    <button type="button" class="btn-remove" onclick="this.parentElement.parentElement.remove()">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            `;
            container.appendChild(newRow);
        }

        function addOtroDescuento() {
            const container = document.getElementById('otros-descuentos-container');
            const newRow = document.createElement('div');
            newRow.className = 'form-grid otro-descuento-row';
            newRow.style.alignItems = 'end';
            newRow.innerHTML = `
                <div class="form-group" style="grid-column: span 2;">
                    <label class="form-label">Descripción</label>
                    <input type="text" class="form-input" placeholder="Ej: Ahorro APV">
                </div>
                <div class="form-group">
                    <label class="form-label">Monto</label>
                    <input type="number" class="otro-descuento-monto form-input" placeholder="0">
                </div>
                <div class="form-group">
                    <button type="button" class="btn-remove" onclick="this.parentElement.parentElement.remove()">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            `;
            container.appendChild(newRow);
        }

        function toggleIsapreField() {
            const sistemaSalud = document.getElementById('sistemaSalud').value;
            const isapreField = document.getElementById('isapreField');
            if (sistemaSalud === 'isapre') {
                isapreField.style.display = 'block';
            } else {
                isapreField.style.display = 'none';
                document.getElementById('costoSaludUF').value = '';
            }
        }

        function updateFormForRole() {
            const rol = document.getElementById('tipoProfesional').value;
            const docenteParams = document.getElementById('params-docente');
            const asistenteParams = document.getElementById('params-asistente');
            const docenteHours1 = document.getElementById('horasDocenteContainer');
            const docenteHours2 = document.getElementById('horasDocenteContainer2');
            const parvulosHours = document.getElementById('horasParvulosContainer');
            const mencionContainer = document.getElementById('brpMencionContainer');

            if (rol === 'asistente') {
                docenteParams.style.display = 'none';
                asistenteParams.style.display = 'block';
            } else {
                docenteParams.style.display = 'block';
                asistenteParams.style.display = 'none';
                if (rol === 'docente') {
                    docenteHours1.style.display = 'block';
                    docenteHours2.style.display = 'block';
                    parvulosHours.style.display = 'none';
                    mencionContainer.style.display = 'flex';
                } else { // Párvulos
                    docenteHours1.style.display = 'none';
                    docenteHours2.style.display = 'none';
                    parvulosHours.style.display = 'block';
                    mencionContainer.style.display = 'none';
                }
            }
        }

        function downloadPDF() {
            const results = document.getElementById('results-container');
            if(window.getComputedStyle(results).display === 'none') {
                alert('Primero debes calcular un sueldo para poder descargar el PDF.');
                return;
            }
            const { jsPDF } = window.jspdf;
            html2canvas(results, { scale: 2, backgroundColor: getComputedStyle(document.body).getPropertyValue('--bg-secondary') }).then(canvas => {
                const imgData = canvas.toDataURL('image/png');
                const pdf = new jsPDF('p', 'mm', 'a4');
                const pdfWidth = pdf.internal.pageSize.getWidth();
                const pdfHeight = (canvas.height * pdfWidth) / canvas.width;
                const headerText = "Resumen de Liquidación - Simulador CEST";
                pdf.setFontSize(18);
                pdf.text(headerText, pdfWidth / 2, 15, { align: 'center' });
                pdf.addImage(imgData, 'PNG', 10, 25, pdfWidth - 20, pdfHeight - 20);
                pdf.save(`Liquidacion-Simulador-CEST-${new Date().toISOString().slice(0,10)}.pdf`);
            });
        }

        // Initialize
        changeTheme();
        updateFormForRole();

        // Mobile menu toggle functionality
        document.addEventListener('DOMContentLoaded', function() {
            const mobileMenuButton = document.getElementById('mobile-menu-button');
            const mobileMenu = document.getElementById('mobile-menu');

            mobileMenuButton.addEventListener('click', function() {
                mobileMenu.classList.toggle('hidden');
            });

            // Close mobile menu when clicking outside
            document.addEventListener('click', function(event) {
                if (!mobileMenuButton.contains(event.target) && !mobileMenu.contains(event.target)) {
                    mobileMenu.classList.add('hidden');
                }
            });
        });
    </script>
</body>
</html>
