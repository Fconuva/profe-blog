<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Verificar Pagos en Firebase</title>
    <style>
        body { font-family: monospace; padding: 20px; background: #1e1e1e; color: #fff; }
        pre { background: #2d2d2d; padding: 15px; border-radius: 8px; overflow-x: auto; }
        .status { margin: 20px 0; padding: 15px; border-radius: 8px; }
        .loading { background: #1e3a8a; }
        .success { background: #065f46; }
        .error { background: #7f1d1d; }
    </style>
</head>
<body>
    <h1>üîç Verificador de Pagos Firebase</h1>
    <div id="status" class="status loading">Conectando a Firebase...</div>
    <div id="output"></div>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getDatabase, ref, get } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';

        const firebaseConfig = {
            apiKey: "AIzaSyCzN4xNEE_hKshXbsVqLhWSnzet1pHwRh8",
            authDomain: "profe-blog.firebaseapp.com",
            databaseURL: "https://profe-blog-default-rtdb.firebaseio.com",
            projectId: "profe-blog",
            storageBucket: "profe-blog.firebasestorage.app",
            messagingSenderId: "305920739217",
            appId: "1:305920739217:web:2e08c7469d2988d8b3bc30"
        };

        const status = document.getElementById('status');
        const output = document.getElementById('output');

        try {
            status.textContent = 'Inicializando Firebase...';
            const app = initializeApp(firebaseConfig);
            const database = getDatabase(app);

            status.textContent = 'Leyendo /verified_payments/...';
            const paymentsRef = ref(database, 'verified_payments');
            const snapshot = await get(paymentsRef);

            if (snapshot.exists()) {
                const data = snapshot.val();
                const count = Object.keys(data).length;
                
                status.className = 'status success';
                status.textContent = `‚úÖ Se encontraron ${count} pagos en Firebase`;
                
                output.innerHTML = '<h2>Datos encontrados:</h2><pre>' + 
                    JSON.stringify(data, null, 2) + '</pre>';
                
                // Mostrar tabla
                const table = document.createElement('table');
                table.style.cssText = 'width:100%; border-collapse: collapse; margin-top: 20px;';
                table.innerHTML = `
                    <tr style="background: #374151; text-align: left;">
                        <th style="padding: 10px; border: 1px solid #4b5563;">Payment ID</th>
                        <th style="padding: 10px; border: 1px solid #4b5563;">Email</th>
                        <th style="padding: 10px; border: 1px solid #4b5563;">Nombre</th>
                        <th style="padding: 10px; border: 1px solid #4b5563;">Monto</th>
                        <th style="padding: 10px; border: 1px solid #4b5563;">Fecha</th>
                        <th style="padding: 10px; border: 1px solid #4b5563;">Cuenta Creada</th>
                    </tr>
                `;
                
                Object.values(data).forEach(payment => {
                    const row = table.insertRow();
                    row.innerHTML = `
                        <td style="padding: 10px; border: 1px solid #4b5563;">${payment.paymentId || 'N/A'}</td>
                        <td style="padding: 10px; border: 1px solid #4b5563;">${payment.email || 'N/A'}</td>
                        <td style="padding: 10px; border: 1px solid #4b5563;">${payment.name || 'N/A'}</td>
                        <td style="padding: 10px; border: 1px solid #4b5563;">$${payment.amount || 0}</td>
                        <td style="padding: 10px; border: 1px solid #4b5563;">${payment.verifiedAt || 'N/A'}</td>
                        <td style="padding: 10px; border: 1px solid #4b5563;">${payment.accountCreated ? '‚úÖ S√≠' : '‚è≥ No'}</td>
                    `;
                });
                
                output.appendChild(table);
            } else {
                status.className = 'status error';
                status.textContent = '‚ö†Ô∏è No hay pagos en /verified_payments/';
                output.innerHTML = '<p>La ruta /verified_payments/ existe pero est√° vac√≠a.</p>';
            }
        } catch (error) {
            status.className = 'status error';
            status.textContent = '‚ùå Error: ' + error.message;
            output.innerHTML = '<pre>' + error.stack + '</pre>';
            console.error('Error completo:', error);
        }
    </script>
</body>
</html>
